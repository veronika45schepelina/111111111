<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Центр супервизоров.рф</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Raleway:wght@300;400;500;600;700&display=swap"
        rel="stylesheet" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <style>
        :root {
            --primary: #CDC7E3; /* Основной цвет - лавандовый */
            --primary-light: #F6EAF3; /* Светлый вариант основного */
            --primary-dark: #A88DC0; /* Темный вариант основного */
            --secondary: #f4d5ff; /* Вторичный лавандовый */
            --accent: #B4A9D2; /* Акцентный лавандовый */
            --text: #2E1A47; /* Темный фиолетовый для текста */
            --text-light: #5A4A6E; /* Светлый текст для подзаголовков */
            --background: #F6EAF3; /* Светлый лавандовый фон */
            --background-alt: #E4D6E9; /* Альтернативный фон */
            --card: #FFFFFF; /* Белый для карточек */
            --shadow: rgba(168, 141, 192, 0.15); /* Мягкая тень в лавандовом тоне */
            --shadow-deep: rgba(168, 141, 192, 0.3); /* Глубокая тень */
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --error: #E57373; /* Красный для ошибок */
            --success: #81C784; /* Зеленый для успеха (можно изменить на лавандовый) */
            --gradient-primary: linear-gradient(135deg, var(--primary-dark) 0%, var(--primary) 100%);
            --gradient-accent: linear-gradient(135deg, var(--accent) 0%, var(--secondary) 100%);
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: "Inter", sans-serif;
            background: var(--background);
            color: var(--text);
            line-height: 1.7;
            overflow-x: hidden;
        }
        /* Навигация - улучшенная с мягкими переходами */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1.2rem 5%;
            background: var(--gradient-primary);
            box-shadow: 0 4px 20px var(--shadow-deep);
            z-index: 1000;
            transition: var(--transition);
        }
        .navbar.scrolled {
            padding: 0.8rem 5%;
            background: rgba(168, 141, 192, 0.95);
            backdrop-filter: blur(20px);
            box-shadow: 0 8px 32px var(--shadow-deep);
        }
        .nav-left {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }
        .nav-logo {
            font-family: "Raleway", sans-serif;
            font-weight: 700;
            font-size: 1.8rem;
            color: var(--text-light);
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
            letter-spacing: 1px;
        }
        .nav-right {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }
        .nav-auth {
            display: flex;
            gap: 1.5rem;
            align-items: center;
        }
        .nav-logout {
            display: none;
            align-items: center;
        }
        .btn {
            padding: 0.8rem 1.8rem;
            border-radius: 50px;
            font-family: "Raleway", sans-serif;
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            display: inline-block;
            text-align: center;
            border: none;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }
        .btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        .btn:hover::before {
            left: 100%;
        }
        .btn-login {
            background: transparent;
            color: var(--text);
            border: 2px solid var(--primary-dark);
        }
        .btn-login:hover {
            background: var(--primary-light);
            color: var(--primary-dark);
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 6px 16px var(--shadow-deep);
        }
        .btn-register {
            background: var(--gradient-primary);
            color: #fff;
            border: 2px solid var(--primary-dark);
        }
        .btn-register:hover {
            background: var(--primary-light);
            color: var(--primary-dark);
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 6px 16px var(--shadow-deep);
        }
        .btn-info {
            background: var(--gradient-accent);
            color: var(--text);
            border: 2px solid transparent;
        }
        .btn-info:hover {
            background: var(--primary);
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 6px 16px var(--shadow-deep);
        }
        .menu-toggle {
            font-size: 1.7rem;
            cursor: pointer;
            color: var(--text-light);
            z-index: 1001;
            transition: var(--transition);
        }
        .menu-toggle:hover {
            transform: scale(1.1) rotate(5deg);
        }
        /* Мобильное меню - улучшенное с градиентом */
        .mobile-menu {
            position: fixed;
            top: 0;
            right: -100%;
            width: 85%;
            max-width: 350px;
            height: 100vh;
            background: var(--gradient-accent);
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            padding-top: 5rem;
            box-shadow: -10px 0 30px var(--shadow-deep);
            transition: right 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 999;
            border-left: 3px solid var(--primary);
        }
        .mobile-menu.active {
            right: 0;
        }
        .mobile-menu .nav-item {
            font-size: 1.3rem;
            padding: 1.2rem 2.5rem;
            width: 100%;
            text-align: left;
            color: var(--text);
            transition: var(--transition);
            opacity: 0;
            transform: translateX(30px);
            font-weight: 500;
            position: relative;
        }
        .mobile-menu.active .nav-item {
            opacity: 1;
            transform: translateX(0);
        }
        .mobile-menu .nav-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 4px;
            height: 20px;
            background: var(--primary);
            border-radius: 2px;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .mobile-menu .nav-item:hover::before {
            opacity: 1;
        }
        .mobile-menu .nav-item:hover {
            background: var(--primary-light);
            transform: translateX(10px);
            padding-left: 3rem;
        }
        .mobile-menu .nav-auth {
            flex-direction: column;
            padding: 1.5rem 2.5rem;
            gap: 1.2rem;
            opacity: 0;
            transform: translateX(30px);
            transition: var(--transition);
            transition-delay: 0.35s;
        }
        .mobile-menu.active .nav-auth {
            opacity: 1;
            transform: translateX(0);
        }
        .mobile-menu .nav-logout {
            display: none;
            flex-direction: column;
            padding: 1.5rem 2.5rem;
            opacity: 0;
            transform: translateX(30px);
            transition: var(--transition);
            transition-delay: 0.35s;
        }
        .mobile-menu.active .nav-logout {
            opacity: 1;
            transform: translateX(0);
        }
        .menu-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.4s ease;
            z-index: 998;
            backdrop-filter: blur(5px);
        }
        .menu-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        /* Модальные окна - улучшенные с анимацией и градиентами */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(46, 26, 71, 0.8); /* Темный лавандовый оверлей */
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            backdrop-filter: blur(10px);
        }
        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .modal {
            background: var(--card);
            border-radius: 25px;
            padding: 2.5rem;
            width: 90%;
            max-width: 500px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 50px var(--shadow-deep);
            transform: translateY(50px) scale(0.95);
            opacity: 0;
            transition: var(--transition);
            position: relative;
            border: 2px solid var(--primary-light);
            animation: modalSlideIn 0.4s ease forwards;
        }
        @keyframes modalSlideIn {
            to {
                transform: translateY(0) scale(1);
                opacity: 1;
            }
        }
        .modal-overlay.active .modal {
            transform: translateY(0) scale(1);
            opacity: 1;
        }
        .modal-large {
            max-width: 100vw;
            max-height: 100vh;
            width: 100vw;
            height: 100vh;
            padding: 1rem;
            border-radius: 0;
        }
        .modal-wide {
            max-width: 800px;
        }
        .modal-close {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
            font-size: 1.8rem;
            cursor: pointer;
            color: var(--text-light);
            transition: var(--transition);
            background: none;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .modal-close:hover {
            color: var(--primary-dark);
            background: var(--primary-light);
            transform: rotate(90deg) scale(1.1);
        }
        .modal-title {
            font-family: "Raleway", sans-serif;
            font-weight: 700;
            font-size: 1.8rem;
            margin-bottom: 1.5rem;
            color: var(--text);
            text-align: center;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        .form-group {
            margin-bottom: 1.5rem;
        }
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--text);
            text-shadow: 0 1px 1px rgba(0,0,0,0.1);
        }
        .form-input {
            width: 100%;
            padding: 1rem 1.2rem;
            border: 2px solid var(--secondary);
            border-radius: 15px;
            font-family: "Inter", sans-serif;
            font-size: 1rem;
            transition: var(--transition);
            background: var(--background-alt);
            color: var(--text);
        }
        .form-input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(168, 141, 192, 0.3);
            background: var(--card);
            transform: scale(1.02);
        }
        .form-input.error {
            border-color: var(--error);
            background: #fce4e4;
            animation: shake 0.5s ease;
        }
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }
        .form-error {
            color: var(--error);
            font-size: 0.85rem;
            margin-top: 0.3rem;
            display: none;
            font-weight: 500;
        }
        .form-error.show {
            display: block;
            animation: fadeIn 0.3s ease;
        }
        .role-selector {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }
        .role-option {
            flex: 1;
            text-align: center;
            padding: 1.2rem;
            border: 2px solid var(--secondary);
            border-radius: 15px;
            cursor: pointer;
            transition: var(--transition);
            background: var(--background-alt);
            color: var(--text);
            position: relative;
            overflow: hidden;
        }
        .role-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--gradient-accent);
            opacity: 0;
            transition: opacity 0.3s;
        }
        .role-option:hover::before {
            opacity: 0.1;
        }
        .role-option:hover {
            border-color: var(--primary);
            background: var(--accent);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px var(--shadow);
        }
        .role-option.selected {
            border-color: var(--primary);
            background: var(--gradient-primary);
            color: #fff;
            transform: scale(1.05);
        }
        .role-icon {
            font-size: 2.2rem;
            margin-bottom: 0.5rem;
            color: var(--primary);
            transition: var(--transition);
        }
        .role-option.selected .role-icon {
            color: #fff;
        }
        .form-footer {
            text-align: center;
            margin-top: 1.5rem;
        }
        .form-link {
            color: var(--primary);
            text-decoration: none;
            cursor: pointer;
            transition: var(--transition);
            font-weight: 500;
        }
        .form-link:hover {
            text-decoration: underline;
            color: var(--primary-dark);
            text-shadow: 0 0 5px rgba(168, 141, 192, 0.5);
        }
        /* Личный кабинет - улучшенный с градиентами */
        .dashboard {
            display: none;
            padding: 6rem 5% 4rem;
            min-height: 100vh;
            background: var(--gradient-accent);
        }
        .dashboard-header {
            margin-bottom: 2.5rem;
            text-align: center;
        }
        .dashboard-title {
            font-family: "Raleway", sans-serif;
            font-weight: 700;
            font-size: 2.5rem;
            color: var(--text);
            margin-bottom: 0.5rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .dashboard-subtitle {
            color: var(--text-light);
            font-size: 1.2rem;
            font-weight: 500;
        }
        .dashboard-tabs {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            border-bottom: 3px solid var(--primary);
            padding-bottom: 1rem;
            overflow-x: auto;
            white-space: nowrap;
            background: var(--card);
            padding: 1rem;
            border-radius: 20px;
            box-shadow: 0 4px 15px var(--shadow);
        }
        .tab-btn {
            padding: 0.8rem 1.5rem;
            background: transparent;
            border: none;
            border-radius: 12px;
            font-family: "Raleway", sans-serif;
            font-weight: 500;
            font-size: 1rem;
            color: var(--text-light);
            cursor: pointer;
            transition: var(--transition);
            min-width: 120px;
            white-space: nowrap;
            position: relative;
        }
        .tab-btn::after {
            content: '';
            position: absolute;
            bottom: -3px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 3px;
            background: var(--primary);
            transition: width 0.3s ease;
        }
        .tab-btn:hover::after {
            width: 80%;
        }
        .tab-btn.active {
            background: var(--gradient-primary);
            color: #fff;
            box-shadow: 0 4px 12px var(--shadow-deep);
        }
        .tab-btn.active::after {
            width: 100%;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
            animation: fadeInUp 0.5s ease;
        }
        /* Поиск специалистов - улучшенный с градиентами */
        .search-filters {
            background: var(--card);
            border-radius: 20px;
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: 0 10px 30px var(--shadow-deep);
            border: 1px solid var(--secondary);
        }
        .filter-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }
        .specialists-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 2rem;
        }
        .specialist-card {
            background: #e4d6e9;
            border-radius: 20px;
            overflow: hidden;
            box-shadow: 0 10px 30px var(--shadow);
            transition: var(--transition);
            border: 1px solid var(--secondary);
            position: relative;
        }
        .specialist-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient-primary);
        }
        .specialist-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px var(--shadow-deep);
        }
        .specialist-header {
            padding: 2rem;
            background: var(--gradient-accent);
            text-align: center;
            position: relative;
        }
        .specialist-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            margin-bottom: 1rem;
            border: 5px solid var(--primary);
            box-shadow: 0 6px 20px rgba(0,0,0,0.1);
            transition: var(--transition);
        }
        .specialist-card:hover .specialist-avatar {
            transform: scale(1.05);
        }
        .specialist-name {
            font-family: "Raleway", sans-serif;
            font-weight: 700;
            font-size: 1.4rem;
            margin-bottom: 0.3rem;
            color: var(--text);
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        .specialist-specialty {
            color: var(--text-light);
            font-weight: 500;
            font-size: 1.1rem;
        }
        .specialist-body {
            padding: 2rem;
            background: var(--background-alt);
        }
        .specialist-info {
            margin-bottom: 1rem;
        }
        .specialist-rating {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }
        .rating-stars {
            color: #FFD700;
            font-size: 1.1rem;
        }
        .specialist-price {
            font-weight: 700;
            color: var(--primary-dark);
            margin-bottom: 1rem;
            font-size: 1.2rem;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        .specialist-footer {
            padding: 0 2rem 2rem;
            background: var(--background-alt);
        }
        /* Календарь - улучшенный с градиентами */
        .calendar-container {
            background: var(--gradient-accent);
            border-radius: 25px;
            padding: 2.5rem;
            box-shadow: 0 12px 40px var(--shadow-deep);
            overflow: hidden;
            position: relative;
            border: 2px solid var(--primary-light);
        }
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }
        .calendar-header h3 {
            font-family: "Raleway", sans-serif;
            font-size: 2rem;
            color: var(--text);
            animation: fadeInUp 0.5s ease;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1rem;
            margin-top: 1rem;
        }
        .calendar-day {
            text-align: center;
            padding: 1.2rem;
            border-radius: 12px;
            cursor: pointer;
            background: var(--card);
            border: 2px solid var(--secondary);
            font-weight: 600;
            transition: var(--transition);
            color: var(--text);
            position: relative;
            overflow: hidden;
        }
        .calendar-day::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 2px;
            background: var(--primary);
            transform: scaleX(0);
            transition: transform 0.3s ease;
        }
        .calendar-day:hover::before {
            transform: scaleX(1);
        }
        .calendar-day:hover {
            transform: scale(1.05);
            background: var(--primary-light);
            color: var(--text);
            border-color: var(--primary);
            box-shadow: 0 4px 15px var(--shadow);
        }
        .calendar-day.selected {
            background: var(--gradient-primary);
            color: #fff;
            box-shadow: 0 6px 20px rgba(168, 141, 192, 0.4);
            animation: pulse 1.5s infinite;
            border-color: var(--primary-dark);
            transform: scale(1.1);
        }
        .calendar-day.disabled {
            color: #999;
            cursor: not-allowed;
            background: #f0f0f0;
            border-color: #ddd;
            opacity: 0.5;
        }
        .calendar-day.has-bookings {
            background: var(--accent);
            color: var(--text);
            border-color: var(--primary);
            font-weight: 700;
            position: relative;
        }
        .calendar-day.has-bookings::after {
            content: '●';
            position: absolute;
            top: 5px;
            right: 5px;
            color: var(--success);
            font-size: 1rem;
        }
        @keyframes pulse {
            0%, 100% { transform: scale(1.1); }
            50% { transform: scale(1.15); }
        }
        .time-slots {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
            gap: 1rem;
            margin-top: 2rem;
        }
        .time-slot {
            padding: 1rem;
            text-align: center;
            border: 2px solid var(--secondary);
            border-radius: 12px;
            cursor: pointer;
            background: var(--card);
            transition: var(--transition);
            animation: fadeInUp 0.5s ease;
            font-weight: 600;
            color: var(--text);
            position: relative;
        }
        .time-slot:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px var(--shadow);
            border-color: var(--primary);
        }
        .time-slot.selected {
            background: var(--gradient-primary);
            color: #fff;
            border-color: var(--primary-dark);
            transform: scale(1.05);
        }
        .time-slot.booked {
            background: linear-gradient(135deg, #ffebee 0%, #ffcdd2 100%);
            color: var(--error);
            cursor: not-allowed;
            position: relative;
            border-color: var(--error);
            font-weight: 600;
        }
        .time-slot.booked::after {
            content: attr(data-client);
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: var(--card);
            padding: 0.8rem 1.2rem;
            border-radius: 12px;
            box-shadow: 0 6px 20px var(--shadow);
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s ease;
            margin-top: 0.5rem;
            z-index: 10;
            border: 1px solid var(--secondary);
            color: var(--text);
            font-size: 0.9rem;
            max-width: 200px;
            text-align: center;
        }
        .time-slot.booked:hover::after {
            opacity: 1;
            visibility: visible;
        }
        .time-slot.available {
            border-color: var(--success);
            background: var(--background-alt);
            box-shadow: 0 2px 8px var(--shadow);
        }
        /* Список клиентов - улучшенный с градиентами */
        .clients-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 2rem;
        }
        .client-card {
            background: var(--card);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 30px var(--shadow);
            transition: var(--transition);
            cursor: pointer;
            border: 1px solid var(--secondary);
            position: relative;
            overflow: hidden;
        }
        .client-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient-primary);
        }
        .client-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px var(--shadow-deep);
        }
        .plan-card {
            background: var(--gradient-accent);
            border-left: 5px solid var(--primary);
        }
        .client-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        .client-avatar {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--primary);
            transition: var(--transition);
        }
        .client-card:hover .client-avatar {
            transform: scale(1.1);
        }
        .client-name {
            font-family: "Raleway", sans-serif;
            font-weight: 700;
            font-size: 1.3rem;
            color: var(--text);
        }
        .client-next-session {
            color: var(--primary-dark);
            font-weight: 500;
            font-size: 0.95rem;
        }
        .client-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }
        .client-actions .btn {
            flex: 1;
            min-width: 100px;
            padding: 0.6rem 1rem;
            font-size: 0.9rem;
        }
        /* Детальный вид клиента - улучшенный */
        .client-detail-modal .modal {
            max-width: 750px;
        }
        .client-detail {
            display: none;
            background: var(--card);
            border-radius: 25px;
            padding: 2.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 12px 35px var(--shadow-deep);
            border: 1px solid var(--secondary);
        }
        .client-detail.active {
            display: block;
            animation: fadeInUp 0.5s ease;
        }
        .client-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        .client-problem {
            background: var(--accent);
            padding: 1.5rem;
            border-radius: 15px;
            font-weight: 600;
            color: var(--text);
            border-left: 5px solid var(--primary);
            box-shadow: 0 4px 15px var(--shadow);
        }
        /* Дневник клиента - улучшенный */
        .client-journal {
            background: var(--card);
            border-radius: 20px;
            padding: 2rem;
            box-shadow: 0 10px 30px var(--shadow-deep);
            margin-bottom: 2rem;
            border: 1px solid var(--secondary);
        }
        .journal-entry {
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--secondary);
            animation: fadeInUp 0.5s ease;
        }
        .journal-date {
            font-weight: 700;
            color: var(--primary-dark);
            margin-bottom: 0.5rem;
            font-size: 1.2rem;
        }
        .journal-content {
            color: var(--text);
            background: var(--accent);
            padding: 1.5rem;
            border-radius: 15px;
            font-size: 1rem;
            line-height: 1.7;
            box-shadow: inset 0 2px 10px var(--shadow);
        }
        .journal-form textarea {
            width: 100%;
            min-height: 160px;
            padding: 1.2rem;
            border: 2px solid var(--secondary);
            border-radius: 15px;
            font-family: "Inter", sans-serif;
            resize: vertical;
            transition: var(--transition);
            background: var(--background-alt);
            color: var(--text);
            font-size: 1rem;
        }
        .journal-form textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(168, 141, 192, 0.3);
            background: var(--card);
            transform: scale(1.01);
        }
        /* Уведомления - улучшенные с градиентами */
        .notification-container {
            position: fixed;
            top: 100px;
            right: 20px;
            z-index: 3000;
        }
        .notification {
            background: var(--card);
            border-radius: 15px;
            padding: 1.2rem 1.8rem;
            margin-bottom: 0.5rem;
            box-shadow: 0 10px 30px var(--shadow-deep);
            display: flex;
            align-items: center;
            gap: 1rem;
            transform: translateX(100%);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid var(--secondary);
            border-left: 5px solid;
            font-weight: 500;
            color: var(--text);
            position: relative;
            overflow: hidden;
        }
        .notification::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background: var(--gradient-primary);
        }
        .notification.show {
            transform: translateX(0);
            opacity: 1;
        }
        .notification.hide {
            transform: translateX(100%);
            opacity: 0;
        }
        .notification.success {
            border-left-color: var(--success);
        }
        .notification.error {
            border-left-color: var(--error);
            background: #fce4e4;
        }
        .notification.info {
            border-left-color: var(--primary);
        }
        .notification.new-appointment {
            border-left-color: #f39c12;
            background: #fef9e7;
        }
        .notification-icon {
            font-size: 1.3rem;
        }
        .notification.success .notification-icon {
            color: var(--success);
        }
        .notification.error .notification-icon {
            color: var(--error);
        }
        .notification.info .notification-icon {
            color: var(--primary);
        }
        .notification.new-appointment .notification-icon {
            color: #f39c12;
        }
        /* Индикатор загрузки - улучшенный */
        .loader-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(246, 234, 243, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 4000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
            backdrop-filter: blur(10px);
        }
        .loader-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        .loader {
            width: 60px;
            height: 60px;
            border: 6px solid var(--accent);
            border-top: 6px solid var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        /* Герой секция - улучшенная с градиентом и волнами */
        .hero {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            padding: 6rem 5% 4rem;
            background: var(--gradient-accent);
            position: relative;
            overflow: hidden;
        }
        .hero::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1440 320'%3E%3Cpath fill='%23CDC7E3' fill-opacity='0.15' d='M0,128L48,117.3C96,107,192,85,288,112C384,139,480,213,576,218.7C672,224,768,160,864,138.7C960,117,1056,139,1152,149.3C1248,160,1344,160,1392,160L1440,160L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z'%3E%3C/path%3E%3C/svg%3E");
            background-size: cover;
            background-position: center;
            z-index: 0;
        }
        .hero-content {
            max-width: 1000px;
            position: relative;
            z-index: 1;
        }
        .hero-title {
            font-family: "Raleway", sans-serif;
            font-weight: 700;
            font-size: 3.5rem;
            line-height: 1.2;
            margin-bottom: 1.5rem;
            color: var(--text);
            opacity: 0;
            transform: translateY(30px);
            animation: fadeInUp 1s ease forwards 0.3s;
            text-shadow: 0 3px 6px rgba(0,0,0,0.1);
        }
        .hero-subtitle {
            font-family: "Raleway", sans-serif;
            font-weight: 400;
            font-size: 2rem;
            margin-bottom: 2rem;
            color: var(--text-light);
            opacity: 0;
            transform: translateY(30px);
            animation: fadeInUp 1s ease forwards 0.6s;
            font-weight: 500;
        }
        .divider {
            width: 200px;
            height: 6px;
            background: var(--gradient-primary);
            margin: 0 auto 3rem;
            border-radius: 3px;
            opacity: 0;
            transform: scaleX(0);
            animation: scaleIn 0.8s ease forwards 0.9s;
            box-shadow: 0 2px 10px rgba(168, 141, 192, 0.5);
        }
        .hero-description {
            font-family: "Inter", sans-serif;
            font-size: 1.4rem;
            max-width: 900px;
            margin: 0 auto 3rem;
            color: var(--text-light);
            opacity: 0;
            transform: translateY(30px);
            animation: fadeInUp 1s ease forwards 1.2s;
            font-weight: 400;
            line-height: 1.8;
        }
        /* Особенности - улучшенные с градиентами */
        .features {
            padding: 6rem 5%;
            background: var(--background);
        }
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 2.5rem;
            max-width: 1200px;
            margin: 0 auto;
        }
        .feature-card {
            background: var(--card);
            border-radius: 25px;
            padding: 3rem 2rem;
            text-align: center;
            box-shadow: 0 12px 35px var(--shadow);
            transition: var(--transition);
            opacity: 0;
            transform: translateY(40px);
            border: 1px solid var(--secondary);
            position: relative;
            overflow: hidden;
        }
        .feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient-primary);
        }
        .feature-card.animate {
            animation: fadeInUp 0.8s ease forwards;
        }
        .feature-card:nth-child(2) { animation-delay: 0.2s; }
        .feature-card:nth-child(3) { animation-delay: 0.4s; }
        .feature-card:hover {
            transform: translateY(-12px);
            box-shadow: 0 20px 45px var(--shadow-deep);
        }
        .feature-icon {
            font-size: 3.5rem;
            color: var(--primary);
            margin-bottom: 1.5rem;
            text-shadow: 0 2px 6px rgba(168, 141, 192, 0.3);
            transition: var(--transition);
        }
        .feature-card:hover .feature-icon {
            transform: rotate(5deg) scale(1.1);
        }
        .feature-title {
            font-family: "Raleway", sans-serif;
            font-weight: 700;
            font-size: 1.6rem;
            margin-bottom: 1rem;
            color: var(--text);
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        .feature-description {
            color: var(--text-light);
            font-size: 1.1rem;
            line-height: 1.7;
        }
        /* Секция помощи - улучшенная с градиентами */
        .help {
            padding: 6rem 5%;
            background: var(--background-alt);
            position: relative;
        }
        .help::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1440 320'%3E%3Cpath fill='%23CDC7E3' fill-opacity='0.15' d='M0,128L48,117.3C96,107,192,85,288,112C384,139,480,213,576,218.7C672,224,768,160,864,138.7C960,117,1056,139,1152,149.3C1248,160,1344,160,1392,160L1440,160L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z'%3E%3C/path%3E%3C/svg%3E");
            background-size: cover;
            background-position: center;
            z-index: 0;
        }
        .section-title {
            font-family: "Raleway", sans-serif;
            font-weight: 700;
            font-size: 3rem;
            text-align: center;
            margin-bottom: 4rem;
            position: relative;
            z-index: 1;
            color: var(--text);
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .section-title::after {
            content: "";
            position: absolute;
            bottom: -20px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 5px;
            background: var(--gradient-primary);
            border-radius: 3px;
            box-shadow: 0 2px 10px rgba(168, 141, 192, 0.5);
        }
        .help-cards {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 2.5rem;
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }
        .help-card {
            background: var(--card);
            border-radius: 25px;
            padding: 3rem;
            box-shadow: 0 12px 35px var(--shadow);
            transition: var(--transition);
            opacity: 0;
            transform: translateY(40px);
            border: 1px solid var(--secondary);
            position: relative;
            overflow: hidden;
        }
        .help-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: var(--gradient-primary);
        }
        .help-card.animate {
            animation: fadeInUp 0.8s ease forwards;
        }
        .help-card:nth-child(1) { animation-delay: 0.1s; }
        .help-card:nth-child(2) { animation-delay: 0.2s; }
        .help-card:nth-child(3) { animation-delay: 0.3s; }
        .help-card:nth-child(4) { animation-delay: 0.4s; }
        .help-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 45px var(--shadow-deep);
        }
        .help-title {
            font-family: "Raleway", sans-serif;
            font-weight: 700;
            font-size: 1.6rem;
            margin-bottom: 1.5rem;
            color: var(--text);
            display: flex;
            align-items: center;
            gap: 1rem;
            text-shadow: 0 1px 2px rgba(0,0,0,0.1);
        }
        .help-title i {
            color: var(--primary);
            font-size: 2rem;
            transition: var(--transition);
        }
        .help-card:hover .help-title i {
            transform: scale(1.2);
        }
        .help-list {
            list-style: none;
        }
        .help-list li {
            margin-bottom: 1rem;
            padding-left: 2rem;
            position: relative;
            font-size: 1.1rem;
            color: var(--text-light);
            line-height: 1.6;
            transition: var(--transition);
        }
        .help-list li:hover {
            color: var(--text);
            padding-left: 2.5rem;
        }
        .help-list li::before {
            content: "✦";
            color: var(--primary);
            font-size: 1.2rem;
            position: absolute;
            left: 0;
            top: 0.2rem;
            font-weight: bold;
            transition: var(--transition);
        }
        .help-list li:hover::before {
            transform: scale(1.2);
        }
        /* Футер - улучшенный с градиентом */
        .footer {
            background: var(--gradient-primary);
            color: #fff;
            padding: 5rem 5% 2rem;
            text-align: center;
        }
        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 2.5rem;
            text-align: left;
        }
        .footer-logo {
            font-family: "Raleway", sans-serif;
            font-weight: 700;
            font-size: 2rem;
            margin-bottom: 1rem;
            color: #fff;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }
        .footer-description {
            margin-bottom: 1.5rem;
            opacity: 0.9;
            line-height: 1.6;
            font-size: 1.1rem;
        }
        .footer-heading {
            font-family: "Raleway", sans-serif;
            font-weight: 700;
            font-size: 1.4rem;
            margin-bottom: 1.5rem;
            color: #fff;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }
        .footer-links {
            list-style: none;
        }
        .footer-links li {
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: var(--transition);
        }
        .footer-links li:hover {
            transform: translateX(5px);
        }
        .footer-links a {
            color: #fff;
            text-decoration: none;
            opacity: 0.9;
            transition: var(--transition);
            font-weight: 500;
        }
        .footer-links a:hover {
            opacity: 1;
            color: var(--primary-light);
        }
        .social-links {
            display: flex;
            gap: 1rem;
            margin-top: 1.5rem;
            justify-content: center;
        }
        .social-links a {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            transition: var(--transition);
            text-decoration: none;
            font-size: 1.2rem;
        }
        .social-links a:hover {
            background: var(--primary-light);
            transform: translateY(-5px) rotate(360deg);
            color: var(--primary-dark);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .copyright {
            margin-top: 3rem;
            padding-top: 1.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            opacity: 0.8;
            font-weight: 500;
        }
        /* Адаптивность - улучшенная */
        @media (max-width: 1200px) {
            .filter-row {
                grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            }
            .features-grid, .help-cards {
                grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            }
            .hero-content {
                max-width: 800px;
            }
        }
        @media (max-width: 992px) {
            .nav-auth {
                display: none;
            }
            .nav-logout {
                display: none;
            }
            .mobile-menu .nav-auth {
                display: flex;
            }
            .mobile-menu .nav-logout {
                display: flex;
            }
            .role-selector {
                flex-direction: column;
            }
            .features-grid,
            .help-cards {
                grid-template-columns: 1fr;
            }
            .dashboard-tabs {
                flex-wrap: wrap;
                justify-content: center;
            }
            .specialists-grid,
            .clients-list {
                grid-template-columns: 1fr;
            }
            .calendar-grid {
                grid-template-columns: repeat(7, 1fr);
                gap: 0.5rem;
            }
            .time-slots {
                grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
                gap: 0.5rem;
            }
            .hero-title {
                font-size: 2.8rem;
            }
            .hero-subtitle {
                font-size: 1.6rem;
            }
        }
        @media (max-width: 768px) {
            .navbar {
                padding: 1rem 3%;
                flex-wrap: wrap;
                justify-content: space-between;
            }
            .nav-left {
                order: 1;
                flex: 1;
            }
            .nav-logo {
                order: 2;
                flex: 1;
                text-align: center;
                font-size: 1.6rem;
            }
            .nav-right {
                order: 3;
                flex: 1;
                justify-content: flex-end;
            }
            .hero {
                padding: 5rem 3% 3rem;
            }
            .hero-title {
                font-size: 2.5rem;
            }
            .hero-subtitle {
                font-size: 1.4rem;
            }
            .section-title {
                font-size: 2.2rem;
            }
            .help-card {
                padding: 2rem 1.5rem;
            }
            .modal {
                padding: 2rem 1.5rem;
                max-width: 95%;
                margin: 1rem;
            }
            .modal-wide {
                max-width: 95%;
            }
            .dashboard {
                padding: 5rem 3% 3rem;
            }
            .dashboard-tabs {
                flex-direction: row;
                overflow-x: auto;
                gap: 0.5rem;
                padding: 0.5rem;
            }
            .tab-btn {
                width: auto;
                padding: 1rem;
                min-width: 130px;
            }
            .calendar-container {
                padding: 1.5rem;
            }
            .calendar-day {
                padding: 0.8rem;
                font-size: 0.95rem;
            }
            .time-slots {
                grid-template-columns: repeat(auto-fill, minmax(85px, 1fr));
                gap: 0.5rem;
            }
            .time-slot {
                padding: 0.8rem;
                font-size: 0.9rem;
            }
            .filter-row {
                grid-template-columns: 1fr;
            }
            .client-actions .btn {
                padding: 0.8rem;
                font-size: 0.85rem;
            }
            .notification-container {
                right: 10px;
                top: 80px;
                width: calc(100% - 20px);
            }
            .notification {
                padding: 1rem;
                font-size: 0.95rem;
                margin-bottom: 1rem;
            }
            .features-grid, .help-cards {
                gap: 2rem;
            }
            .social-links {
                gap: 1.5rem;
            }
        }
        @media (max-width: 576px) {
            .hero-title {
                font-size: 2.2rem;
            }
            .feature-card,
            .help-card {
                padding: 1.8rem;
            }
            .footer-content {
                grid-template-columns: 1fr;
                text-align: center;
            }
            .social-links {
                justify-content: center;
            }
            .dashboard-tabs {
                flex-wrap: nowrap;
                overflow-x: auto;
            }
            .tab-btn {
                flex: 0 0 auto;
                min-width: 130px;
                padding: 0.7rem 1rem;
                font-size: 0.95rem;
            }
            .nav-right {
                gap: 1rem;
            }
            .btn {
                padding: 0.6rem 1.2rem;
                font-size: 0.9rem;
            }
            .modal-title {
                font-size: 1.6rem;
            }
            .form-input {
                padding: 0.9rem 1rem;
                font-size: 0.95rem;
            }
            .calendar-grid {
                gap: 0.4rem;
            }
            .calendar-day {
                padding: 0.7rem;
                font-size: 0.85rem;
            }
            .time-slots {
                grid-template-columns: repeat(auto-fill, minmax(75px, 1fr));
                gap: 0.4rem;
            }
            .time-slot {
                padding: 0.7rem;
                font-size: 0.85rem;
            }
            .specialist-card {
                margin: 0 auto;
            }
            .client-card {
                padding: 1.5rem;
            }
            .notification {
                font-size: 0.85rem;
                padding: 0.9rem 1.2rem;
            }
            .role-selector {
                gap: 0.5rem;
            }
            .role-option {
                padding: 1rem;
            }
            .emotions-grid {
                grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
                gap: 0.5rem;
            }
            .survey-options {
                gap: 0.8rem;
            }
            .survey-option {
                padding: 1rem;
                font-size: 0.95rem;
            }
        }
        /* Дополнительные стили для оценки занятия */
        .rate-session-modal .modal {
            max-width: 650px;
        }
        .emotions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
            gap: 0.8rem;
            margin-bottom: 1rem;
        }
        .emotion-btn {
            padding: 0.8rem;
            border: 2px solid var(--secondary);
            background: var(--background-alt);
            border-radius: 12px;
            cursor: pointer;
            transition: var(--transition);
            color: var(--text);
            font-weight: 500;
            position: relative;
        }
        .emotion-btn.selected {
            border-color: var(--primary);
            background: var(--primary);
            color: #fff;
            transform: scale(1.05);
        }
        /* Стили для опроса */
        .survey-modal .modal {
            max-width: 650px;
        }
        .survey-options {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        .survey-option {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.2rem;
            border: 2px solid var(--secondary);
            border-radius: 15px;
            cursor: pointer;
            transition: var(--transition);
            background: var(--background-alt);
            color: var(--text);
            position: relative;
        }
        .survey-option:hover,
        .survey-option.selected {
            border-color: var(--primary);
            background: var(--accent);
            transform: translateX(5px);
            box-shadow: 0 4px 15px var(--shadow);
        }
        /* Стили для профильных медиа */
        .media-preview {
            max-width: 220px;
            max-height: 220px;
            border-radius: 15px;
            margin-top: 0.5rem;
            border: 1px solid var(--secondary);
            box-shadow: 0 4px 15px var(--shadow);
        }
        .video-preview {
            width: 100%;
            max-width: 320px;
            height: auto;
            border-radius: 15px;
            border: 1px solid var(--secondary);
            box-shadow: 0 4px 15px var(--shadow);
        }
        /* Стили для заметок специалиста */
        .notes-modal .modal {
            max-width: 750px;
            padding: 3rem;
        }
        .notes-list {
            margin-bottom: 2rem;
        }
        .note-entry {
            background: var(--accent);
            border-radius: 20px;
            padding: 1.8rem;
            margin-bottom: 1rem;
            box-shadow: 0 6px 20px var(--shadow);
            animation: fadeInUp 0.5s ease;
            border: 1px solid var(--secondary);
            transition: var(--transition);
        }
        .note-entry:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px var(--shadow-deep);
        }
        .note-date {
            font-weight: 700;
            color: var(--primary-dark);
            margin-bottom: 0.5rem;
            font-size: 1.2rem;
        }
        .note-content {
            margin-bottom: 1rem;
            color: var(--text);
            line-height: 1.6;
        }
        .note-emotions {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        .emotion-tag {
            background: var(--primary-light);
            color: var(--text);
            padding: 0.4rem 1rem;
            border-radius: 25px;
            font-size: 0.9rem;
            animation: scaleIn 0.3s ease;
            font-weight: 500;
            transition: var(--transition);
        }
        .emotion-tag:hover {
            transform: scale(1.05);
        }
        .notes-form {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        .notes-form textarea {
            min-height: 220px;
            border-radius: 20px;
            padding: 1.8rem;
            box-shadow: inset 0 2px 10px var(--shadow);
            background: var(--background-alt);
            color: var(--text);
            border: 2px solid var(--secondary);
            transition: var(--transition);
        }
        .notes-form textarea:focus {
            border-color: var(--primary);
            box-shadow: 0 0 0 4px rgba(168, 141, 192, 0.3);
        }
        .problem-selector,
        .request-selector {
            margin-bottom: 1rem;
        }
        .problem-option,
        .request-option {
            display: block;
            padding: 0.8rem;
            margin: 0.3rem 0;
            border: 1px solid var(--secondary);
            border-radius: 8px;
            cursor: pointer;
            background: var(--background-alt);
            color: var(--text);
            transition: var(--transition);
        }
        .problem-option.selected,
        .request-option.selected {
            background: var(--primary);
            color: #fff;
            border-color: var(--primary-dark);
            transform: translateX(5px);
        }
        /* Нет результатов */
        .no-results {
            text-align: center;
            color: var(--text-light);
            font-style: italic;
            font-size: 1.2rem;
            padding: 2.5rem;
            animation: fadeIn 0.5s ease;
        }
        .booking-detail {
            margin-bottom: 0.8rem;
            font-weight: 500;
        }
        .booking-summary {
            background: var(--accent);
            padding: 1.5rem;
            border-radius: 15px;
            margin-bottom: 1.5rem;
            border: 1px solid var(--secondary);
            box-shadow: 0 4px 15px var(--shadow);
        }
        /* Emotion options in notes */
        .emotions-selector {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        .emotion-option {
            padding: 0.6rem 1.2rem;
            border: 2px solid var(--secondary);
            border-radius: 25px;
            cursor: pointer;
            transition: var(--transition);
            background: var(--background-alt);
            color: var(--text);
            font-weight: 500;
        }
        .emotion-option.selected {
            border-color: var(--primary);
            background: var(--primary);
            color: #fff;
        }
        /* Client actions buttons */
        .client-actions {
            display: flex;
            gap: 0.5rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }
        .client-actions .btn {
            flex: 1;
            min-width: 100px;
            padding: 0.6rem 1rem;
            font-size: 0.9rem;
        }
        /* Appointments container */
        #appointmentsContainer .help-card {
            margin-bottom: 4rem;
        }
        #allAppointmentsContainer .client-card {
            margin-bottom: 4rem;
        }
        /* Полный профиль клиента */
        .client-full-profile {
            text-align: left;
        }
        .client-full-profile .client-info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        .client-full-profile .profile-section {
            background: var(--accent);
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 1rem;
            border: 1px solid var(--secondary);
            box-shadow: 0 4px 15px var(--shadow);
            transition: var(--transition);
        }
        .client-full-profile .profile-section:hover {
            transform: translateY(-2px);
        }
        .client-full-profile .profile-section h4 {
            color: var(--text);
            margin-bottom: 1rem;
            font-family: "Raleway", sans-serif;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.2rem;
        }
        .client-full-profile .notes-section {
            max-height: 350px;
            overflow-y: auto;
        }
        /* Полный профиль специалиста */
        .specialist-detail-modal .modal {
            max-width: 850px;
        }
        .specialist-full-profile .profile-section {
            background: var(--accent);
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 1rem;
            border: 1px solid var(--secondary);
            box-shadow: 0 4px 15px var(--shadow);
        }
        .specialist-full-profile .profile-section h4 {
            color: var(--text);
            margin-bottom: 1rem;
            font-family: "Raleway", sans-serif;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.2rem;
        }
        .specialist-full-profile .video-section {
            text-align: center;
            margin: 1rem 0;
        }
        .specialist-full-profile .video-preview {
            max-width: 100%;
            height: auto;
            border-radius: 15px;
            border: 1px solid var(--secondary);
            box-shadow: 0 4px 15px var(--shadow);
        }
        /* Widget styles for profiles */
        .profile-section {
            background: var(--accent);
            padding: 2rem;
            border-radius: 15px;
            margin-bottom: 1rem;
            border: 1px solid var(--secondary);
            box-shadow: 0 4px 15px var(--shadow);
        }
        /* Pending appointment card style */
        .pending-appointment-card {
            background: #fef9e7;
            border-left: 5px solid #f39c12;
            border-right: 5px solid #f39c12;
            box-shadow: 0 4px 15px rgba(243, 156, 18, 0.3);
        }
        /* Добавить промежуток между записями */
        #allAppointmentsContainer .client-card,
        #appointmentsContainer .help-card {
            margin-bottom: 4rem;
        }
        /* Scrollbar styling - улучшенный */
        ::-webkit-scrollbar {
            width: 10px;
        }
        ::-webkit-scrollbar-track {
            background: var(--background-alt);
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: var(--gradient-primary);
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }
        /* Дополнительные анимации */
        @keyframes scaleIn {
            from {
                opacity: 0;
                transform: scaleX(0);
            }
            to {
                opacity: 1;
                transform: scaleX(1);
            }
        }
    </style>
</head>
<body>
    <!-- Навигация -->
    <nav class="navbar">
        <div class="nav-left">
            <div class="nav-logo">Центр супервизоров</div>
        </div>
        <div class="nav-right">
            <div class="nav-auth">
                <a class="btn btn-login" id="loginBtn">Вход</a>
                <a class="btn btn-register" id="registerBtn">Регистрация</a>
            </div>
            <div class="nav-logout">
                <a class="btn btn-login" id="navLogoutBtn">Выйти</a>
            </div>
            <div class="menu-toggle">
                <i class="fas fa-bars"></i>
            </div>
        </div>
        <div class="mobile-menu">
            <a class="nav-item" href="#services">Услуги</a>
            <a class="nav-item" href="#reviews">Отзывы</a>
            <a class="nav-item" href="#about">О нас</a>
            <a class="nav-item" href="#blog">Блог</a>
            <a class="nav-item" href="#contacts">Контакты</a>
            <div class="nav-auth">
                <a class="btn btn-login" id="mobileLoginBtn">Вход</a>
                <a class="btn btn-register" id="mobileRegisterBtn">Регистрация</a>
            </div>
            <div class="nav-logout" style="display: none;">
                <a class="btn btn-login" id="mobileLogoutBtn">Выйти</a>
            </div>
        </div>
        <div class="menu-overlay"></div>
    </nav>
    <!-- Герой секция -->
    <section class="hero" id="main-content">
        <div class="hero-content">
            <h1 class="hero-title">
                Центр супервизоров: "Путь к профессиональному росту начинается здесь"
            </h1>
            <div class="divider"></div>
            <p class="hero-description">
                Мы создаем пространство, где каждый психолог может безопасно и уверенно
                обратиться за супервизией, зная, что его примут, поймут и профессионально поддержат.
            </p>
        </div>
    </section>
    <!-- Особенности -->
    <section class="features">
        <div class="features-grid">
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <h3 class="feature-title">Доверие и Безопасность</h3>
                <p class="feature-description">
                    Создаем доверительную атмосферу, где вы можете быть собой без страха
                    осуждения
                </p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-heart"></i>
                </div>
                <h3 class="feature-title">Эмпатия и Открытость</h3>
                <p class="feature-description">
                    Мы слушаем, слышим и понимаем ваши переживания, принимая вас без
                    условий
                </p>
            </div>
            <div class="feature-card">
                <div class="feature-icon">
                    <i class="fas fa-graduation-cap"></i>
                </div>
                <h3 class="feature-title">Профессионализм и Развитие</h3>
                <p class="feature-description">
                    Наши супервизоры постоянно совершенствуются, чтобы помочь вам
                    наиболее эффективно
                </p>
            </div>
        </div>
    </section>
    <!-- Секция помощи -->
    <section class="help" id="services">
        <h2 class="section-title">Мы поможем, если...</h2>
        <div class="help-cards">
            <div class="help-card">
                <h3 class="help-title">
                    <i class="fas fa-child"></i> Вы — психолог, работающий с детьми, и:
                </h3>
                <ul class="help-list">
                    <li>Столкнулись с этическими дилеммами в работе с детьми</li>
                    <li>
                        Нуждаетесь в поддержке при работе с травмами или сложными случаями
                    </li>
                    <li>Хотите обсудить методы работы с подростками</li>
                    <li>
                        Ищете способы избежать выгорания в работе с семьями
                    </li>
                </ul>
            </div>
            <div class="help-card">
                <h3 class="help-title">
                    <i class="fas fa-user"></i> Вы — практикующий психолог, и:
                </h3>
                <ul class="help-list">
                    <li>Чувствуете выгорание, потерю интереса к практике</li>
                    <li>
                        Стоите перед сложным выбором в терапии или супервизии
                    </li>
                    <li>Вас не радуют достижения, хотя "всё вроде есть"</li>
                    <li>
                        Испытываете внутренний кризис — пустоту, потерю смысла,
                        одиночество
                    </li>
                </ul>
            </div>
            <div class="help-card">
                <h3 class="help-title">
                    <i class="fas fa-hands-helping"></i> Вы столкнулись с профессиональными вызовами, и:
                </h3>
                <ul class="help-list">
                    <li>Нуждаетесь в анализе сложных случаев</li>
                    <li>Хотите улучшить свои навыки терапии</li>
                    <li>Вам трудно говорить об ошибках, но молчать невозможно</li>
                    <li>Окружающие не понимают, а внутри — сомнения и вопросы</li>
                </ul>
            </div>
            <div class="help-card">
                <h3 class="help-title"><i class="fas fa-hands"></i> И если:</h3>
                <ul class="help-list">
                    <li>Вам важно, чтобы вас услышали без осуждения</li>
                    <li>Вы ищете профессиональную, бережную супервизию</li>
                    <li>
                        Вы готовы начать путь к профессиональному росту — в удобном темпе и в безопасной
                        среде
                    </li>
                </ul>
            </div>
        </div>
    </section>
    <!-- Футер -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-info">
                <div class="footer-logo">Центр супервизоров</div>
                <p class="footer-description">
                    Пространство, где каждый психолог может получить профессиональную
                    супервизию и поддержку.
                </p>
                <div class="social-links">
                    <a href="#"><i class="fab fa-vk"></i></a>
                    <a href="#"><i class="fab fa-telegram"></i></a>
                    <a href="#"><i class="fab fa-instagram"></i></a>
                    <a href="#"><i class="fab fa-youtube"></i></a>
                </div>
            </div>
            <div class="footer-links-container">
                <h3 class="footer-heading">Навигация</h3>
                <ul class="footer-links">
                    <li><a href="#services">Услуги</a></li>
                    <li><a href="#reviews">Отзывы</a></li>
                    <li><a href="#about">О нас</a></li>
                    <li><a href="#blog">Блог</a></li>
                    <li><a href="#contacts">Контакты</a></li>
                </ul>
            </div>
            <div class="footer-links-container">
                <h3 class="footer-heading">Контакты</h3>
                <ul class="footer-links">
                    <li><i class="fas fa-map-marker-alt"></i> Челябинск</li>
                    <li><i class="fas fa-phone"></i> +7 (999) 123-45-67</li>
                    <li><i class="fas fa-envelope"></i> info@supervision-center.ru</li>
                    <li><i class="fas fa-clock"></i> Пн-Пт: 9:00-21:00</li>
                </ul>
            </div>
        </div>
        <div class="copyright">
            &copy; 2025 Центр супервизоров. Все права защищены.
        </div>
    </footer>
    <!-- Модальное окно входа -->
    <div class="modal-overlay" id="loginModal">
        <div class="modal">
            <span class="modal-close" data-modal="loginModal">&times;</span>
            <h2 class="modal-title">Вход в личный кабинет</h2>
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label" for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" class="form-input" placeholder="Ваш email" required />
                    <div class="form-error" id="loginEmailError">
                        Пожалуйста, введите корректный email
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label" for="loginPassword">Пароль</label>
                    <input type="password" id="loginPassword" class="form-input" placeholder="Ваш пароль" required />
                    <div class="form-error" id="loginPasswordError">
                        Пароль должен содержать не менее 6 символов
                    </div>
                </div>
                <button type="submit" class="btn btn-register" style="width: 100%">
                    Войти
                </button>
                <div class="form-footer">
                    <p>
                        Еще нет аккаунта?
                        <a class="form-link" data-from="loginModal" data-to="registerModal">Зарегистрироваться</a>
                    </p>
                </div>
            </form>
        </div>
    </div>
    <!-- Модальное окно регистрации -->
    <div class="modal-overlay" id="registerModal">
        <div class="modal">
            <span class="modal-close" data-modal="registerModal">&times;</span>
            <h2 class="modal-title">Регистрация</h2>
            <form id="registerForm">
                <div class="role-selector">
                    <div class="role-option selected" data-role="client">
                        <div class="role-icon"><i class="fas fa-user"></i></div>
                        <div>Психолог</div>
                    </div>
                    <div class="role-option" data-role="specialist">
                        <div class="role-icon"><i class="fas fa-graduation-cap"></i></div>
                        <div>Супервизор</div>
                    </div>
                </div>
                <input type="hidden" id="userRole" name="role" value="client" />
                <div class="form-group">
                    <label class="form-label" for="registerName">Имя</label>
                    <input type="text" id="registerName" class="form-input" placeholder="Ваше имя" required />
                    <div class="form-error" id="registerNameError">
                        Пожалуйста, введите ваше имя
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label" for="registerEmail">Email</label>
                    <input type="email" id="registerEmail" class="form-input" placeholder="Ваш email" required />
                    <div class="form-error" id="registerEmailError">
                        Пожалуйста, введите корректный email
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label" for="registerPassword">Пароль</label>
                    <input type="password" id="registerPassword" class="form-input" placeholder="Придумайте пароль"
                        required />
                    <div class="form-error" id="registerPasswordError">
                        Пароль должен содержать не менее 6 символов
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label" for="registerConfirmPassword">Подтверждение пароля</label>
                    <input type="password" id="registerConfirmPassword" class="form-input"
                        placeholder="Повторите пароль" required />
                    <div class="form-error" id="registerConfirmPasswordError">
                        Пароли не совпадают
                    </div>
                </div>
                <button type="submit" class="btn btn-register" style="width: 100%">
                    Зарегистрироваться
                </button>
                <div class="form-footer">
                    <p>
                        Уже есть аккаунт?
                        <a class="form-link" data-from="registerModal" data-to="loginModal">Войти</a>
                    </p>
                </div>
            </form>
        </div>
    </div>

    <!-- Модальное окно опроса -->
    <div class="modal-overlay survey-modal" id="surveyModal">
        <div class="modal">
            <span class="modal-close" data-modal="surveyModal">&times;</span>
            <h2 class="modal-title">Расскажите, какая помощь вам нужна</h2>
            <form id="surveyForm">
                <div class="survey-options">
                    <label class="survey-option" data-problem="Этические дилеммы">
                        <input type="radio" name="problem" value="Этические дилеммы" style="display: none;">
                        <i class="fas fa-question-circle"></i> Этические дилеммы
                    </label>
                    <label class="survey-option" data-problem="Выгорание">
                        <input type="radio" name="problem" value="Выгорание" style="display: none;">
                        <i class="fas fa-fire"></i> Выгорание
                    </label>
                    <label class="survey-option" data-problem="Сложные случаи">
                        <input type="radio" name="problem" value="Сложные случаи" style="display: none;">
                        <i class="fas fa-exclamation-triangle"></i> Сложные случаи
                    </label>
                    <label class="survey-option" data-problem="Развитие навыков">
                        <input type="radio" name="problem" value="Развитие навыков" style="display: none;">
                        <i class="fas fa-chart-line"></i> Развитие навыков
                    </label>
                    <label class="survey-option" data-problem="Другое">
                        <input type="radio" name="problem" value="Другое" style="display: none;">
                        <i class="fas fa-question"></i> Другое
                    </label>
                </div>
                <button type="submit" class="btn btn-register" style="width: 100%; margin-top: 1rem;">
                    Продолжить
                </button>
            </form>
        </div>
    </div>

    <!-- Модальное окно оценки занятия -->
    <div class="modal-overlay rate-session-modal" id="rateSessionModal">
        <div class="modal">
            <span class="modal-close" data-modal="rateSessionModal">&times;</span>
            <h2 class="modal-title">Оцените сессию супервизии</h2>
            <form id="rateSessionForm">
                <div class="form-group">
                    <label class="form-label">Выберите эмоции</label>
                    <div class="emotions-grid">
                        <button type="button" class="emotion-btn" data-emotion="Радость">Радость</button>
                        <button type="button" class="emotion-btn" data-emotion="Спокойствие">Спокойствие</button>
                        <button type="button" class="emotion-btn" data-emotion="Тревога">Тревога</button>
                        <button type="button" class="emotion-btn" data-emotion="Гнев">Гнев</button>
                        <button type="button" class="emotion-btn" data-emotion="Печаль">Печаль</button>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label" for="sessionProblem">С какой проблемой вы пришли?</label>
                    <textarea id="sessionProblem" class="form-input" rows="2"
                        placeholder="Опишите проблему..."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label" for="sessionConclusions">Какие выводы сделали для себя?</label>
                    <textarea id="sessionConclusions" class="form-input" rows="2"
                        placeholder="Ваши выводы..."></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label" for="sessionComment">Комментарий к сессии</label>
                    <textarea id="sessionComment" class="form-input" rows="4"
                        placeholder="Ваши мысли о сессии..."></textarea>
                </div>
                <input type="hidden" id="sessionAppId" value="">
                <button type="submit" class="btn btn-register" style="width: 100%">Сохранить оценку</button>
            </form>
        </div>
    </div>

    <!-- Модальное окно для выбора для заметок к записи -->
    <div class="modal-overlay" id="appointmentNotesChoiceModal">
        <div class="modal">
            <span class="modal-close" data-modal="appointmentNotesChoiceModal">&times;</span>
            <h2 class="modal-title">Заметки к сессии</h2>
            <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 1rem;">
                <button class="btn btn-login" id="sessionNoteBtn">Заметка до сессии</button>
                <button class="btn btn-register" id="conductedBtn">Сессия проведена</button>
            </div>
        </div>
    </div>

    <!-- Модальное окно написания заметки к записи -->
    <div class="modal-overlay" id="appointmentNoteModal">
        <div class="modal">
            <span class="modal-close" data-modal="appointmentNoteModal">&times;</span>
            <h2 class="modal-title">Написать заметку</h2>
            <form id="appointmentNoteForm">
                <div class="form-group">
                    <label class="form-label" for="noteContent">Описание</label>
                    <textarea id="noteContent" class="form-input" rows="4" placeholder="Ваши мысли, эмоции..."
                        required></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">С какой проблемой пришел психолог</label>
                    <div class="survey-options">
                        <label class="survey-option" data-problem="Этические дилеммы">
                            <input type="radio" name="noteProblem" value="Этические дилеммы" style="display: none;">
                            <i class="fas fa-question-circle"></i> Этические дилеммы
                        </label>
                        <label class="survey-option" data-problem="Выгорание">
                            <input type="radio" name="noteProblem" value="Выгорание" style="display: none;">
                            <i class="fas fa-fire"></i> Выгорание
                        </label>
                        <label class="survey-option" data-problem="Сложные случаи">
                            <input type="radio" name="noteProblem" value="Сложные случаи" style="display: none;">
                            <i class="fas fa-exclamation-triangle"></i> Сложные случаи
                        </label>
                        <label class="survey-option" data-problem="Развитие навыков">
                            <input type="radio" name="noteProblem" value="Развитие навыков" style="display: none;">
                            <i class="fas fa-chart-line"></i> Развитие навыков
                        </label>
                        <label class="survey-option" data-problem="Другое">
                            <input type="radio" name="noteProblem" value="Другое" style="display: none;">
                            <i class="fas fa-question"></i> Другое
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Запрос, выявленный в ходе сессии</label>
                    <div class="survey-options">
                        <label class="survey-option" data-request="Самопознание">
                            <input type="radio" name="noteRequest" value="Самопознание" style="display: none;">
                            <i class="fas fa-question"></i> Самопознание
                        </label>
                        <label class="survey-option" data-request="Отношения">
                            <input type="radio" name="noteRequest" value="Отношения" style="display: none;">
                            <i class="fas fa-heart"></i> Отношения
                        </label>
                        <label class="survey-option" data-request="Карьера">
                            <input type="radio" name="noteRequest" value="Карьера" style="display: none;">
                            <i class="fas fa-briefcase"></i> Карьера
                        </label>
                        <label class="survey-option" data-request="Здоровье">
                            <input type="radio" name="noteRequest" value="Здоровье" style="display: none;">
                            <i class="fas fa-heartbeat"></i> Здоровье
                        </label>
                        <label class="survey-option" data-request="Другое">
                            <input type="radio" name="noteRequest" value="Другое" style="display: none;">
                            <i class="fas fa-question"></i> Другое
                        </label>
                    </div>
                </div>
                <button type="submit" class="btn btn-register" style="width: 100%">Сохранить заметку</button>
            </form>
        </div>
    </div>

    <!-- Личный кабинет психолога (клиента) -->
    <section class="dashboard" id="clientDashboard">
        <div class="dashboard-header">
            <h1 class="dashboard-title">Личный кабинет психолога</h1>
            <p class="dashboard-subtitle">
                Добро пожаловать, <span id="clientName">Алексей</span>!
            </p>
        </div>

        <div class="dashboard-tabs">
            <button class="tab-btn active" data-tab="search">
                Поиск супервизора
            </button>
            <button class="tab-btn" data-tab="appointments">Мои сессии</button>
            <button class="tab-btn" data-tab="journal">Мой дневник</button>
            <button class="tab-btn" data-tab="profile">Профиль</button>
        </div>

        <div class="tab-content active" id="searchTab">
            <div class="search-filters">
                <div class="filter-row">
                    <div class="form-group">
                        <label class="form-label" for="specialtyFilter">Специализация</label>
                        <select id="specialtyFilter" class="form-input">
                            <option value="">Все специализации</option>
                            <option value="Супервизия для семейных психологов">Супервизия для семейных психологов</option>
                            <option value="Супервизия для детских психологов">Супервизия для детских психологов</option>
                            <option value="Клиническая супервизия">Клиническая супервизия</option>
                            <option value="Супервизия для нейропсихологов">Супервизия для нейропсихологов</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="priceFilter">Цена за сессию</label>
                        <select id="priceFilter" class="form-input">
                            <option value="">Любая</option>
                            <option value="1000-2000">1000-2000 руб.</option>
                            <option value="2000-3000">2000-3000 руб.</option>
                            <option value="3000-5000">3000-5000 руб.</option>
                            <option value="5000+">от 5000 руб.</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label class="form-label" for="ratingFilter">Рейтинг</label>
                        <select id="ratingFilter" class="form-input">
                            <option value="">Любой</option>
                            <option value="4+">от 4 звезд</option>
                            <option value="4.5+">от 4.5 звезд</option>
                        </select>
                    </div>
                </div>

                <div class="filter-row">
                    <div class="form-group">
                        <label class="form-label" for="searchInput">Поиск по имени</label>
                        <input type="text" id="searchInput" class="form-input" placeholder="Введите имя супервизора" />
                    </div>

                    <button class="btn btn-register" id="applyFilters">
                        Применить фильтры
                    </button>
                </div>
            </div>

            <div class="specialists-grid" id="specialistsContainer">
                <!-- Супервизоры будут добавляться через JavaScript -->
            </div>
        </div>

        <div class="tab-content" id="appointmentsTab">
            <h2>Мои сессии супервизии</h2>
            <div id="appointmentsContainer">
                <!-- Сессии будут добавляться через JavaScript -->
            </div>
        </div>

        <div class="tab-content" id="journalTab">
            <h2>Мой дневник эмоций</h2>
            <div class="journal-container">
                <div id="journalEntries">
                    <!-- Записи дневника будут добавляться через JavaScript -->
                </div>
                <form id="journalForm" class="journal-form">
                    <div class="form-group">
                        <label class="form-label" for="journalContent">Описание чувств и эмоций</label>
                        <textarea id="journalContent" class="form-input"
                            placeholder="Опишите свои чувства и эмоции сегодня..." required></textarea>
                    </div>
                    <button type="submit" class="btn btn-register">
                        Добавить запись
                    </button>
                </form>
            </div>
        </div>

        <div class="tab-content" id="profileTab">
            <h2>Мой профиль</h2>
            <form id="clientProfileForm">
                <div class="form-group">
                    <label class="form-label" for="clientProfileName">Имя</label>
                    <input type="text" id="clientProfileName" class="form-input" value="Алексей" />
                </div>

                <div class="form-group">
                    <label class="form-label" for="clientProfileEmail">Email</label>
                    <input type="email" id="clientProfileEmail" class="form-input" value="alexey@example.com"
                        readonly />
                </div>

                <div class="form-group">
                    <label class="form-label" for="clientProfilePhone">Телефон</label>
                    <input type="tel" id="clientProfilePhone" class="form-input" placeholder="+7 (999) 123-45-67" />
                </div>

                <div class="form-group">
                    <label class="form-label" for="clientProfileBirthdate">Дата рождения</label>
                    <input type="date" id="clientProfileBirthdate" class="form-input" />
                </div>

                <div class="form-group">
                    <label class="form-label" for="clientProfilePhoto">Фото профиля</label>
                    <input type="file" id="clientProfilePhoto" class="form-input" accept="image/*">
                    <img id="clientPhotoPreview" class="media-preview" style="display: none;">
                </div>

                <button type="submit" class="btn btn-register">
                    Сохранить изменения
                </button>
            </form>
        </div>
    </section>

    <!-- Личный кабинет супервизора -->
    <section class="dashboard" id="specialistDashboard">
        <div class="dashboard-header">
            <h1 class="dashboard-title">Кабинет супервизора</h1>
            <p class="dashboard-subtitle">
                Добро пожаловать, <span id="specialistName">Доктор Петрова</span>!
            </p>
        </div>

        <div class="dashboard-tabs">
            <button class="tab-btn active" data-tab="schedule">Расписание</button>
            <button class="tab-btn" data-tab="clients">Мои психологи</button>
            <button class="tab-btn" data-tab="allAppointments">Все сессии</button>
            <button class="tab-btn" data-tab="addClient">Добавить психолога</button>
            <button class="tab-btn" data-tab="specialistProfile">Профиль</button>
        </div>

        <div class="tab-content active" id="scheduleTab">
            <h2>Мое расписание</h2>
            <div class="calendar-container">
                <div class="calendar-header">
                    <h3 id="calendarMonth">Июль 2025</h3>
                    <div>
                        <button class="btn btn-login" id="prevMonth">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <button class="btn btn-login" id="nextMonth">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                </div>

                <div class="calendar-grid" id="calendarDays">
                    <!-- Дни календаря будут добавляться через JavaScript -->
                </div>

                <div class="time-slots" id="timeSlotsContainer">
                    <!-- Временные слоты будут добавляться через JavaScript -->
                </div>
            </div>

            <div class="form-group">
                <button class="btn btn-register" id="saveSchedule">
                    Сохранить расписание
                </button>
            </div>
        </div>

        <div class="tab-content" id="clientsTab">
            <h2>Мои психологи</h2>
            <div class="clients-list" id="clientsContainer">
                <!-- Психологи будут добавляться через JavaScript -->
            </div>
        </div>

        <div class="tab-content" id="allAppointmentsTab">
            <h2>Все сессии</h2>
            <div id="allAppointmentsContainer">
                <!-- Сессии будут добавляться через JavaScript -->
            </div>
        </div>

        <div class="tab-content" id="addClientTab">
            <h2>Добавить психолога</h2>
            <form id="addClientForm">
                <div class="form-group">
                    <label class="form-label" for="clientFirstName">Имя</label>
                    <input type="text" id="clientFirstName" class="form-input" required />
                </div>

                <div class="form-group">
                    <label class="form-label" for="clientLastName">Фамилия</label>
                    <input type="text" id="clientLastName" class="form-input" required />
                </div>

                <div class="form-group">
                    <label class="form-label" for="clientEmail">Email</label>
                    <input type="email" id="clientEmail" class="form-input" />
                </div>

                <div class="form-group">
                    <label class="form-label" for="clientPhone">Телефон</label>
                    <input type="tel" id="clientPhone" class="form-input" required />
                </div>

                <div class="form-group">
                    <label class="form-label" for="clientBirthdate">Дата рождения</label>
                    <input type="date" id="clientBirthdate" class="form-input" />
                </div>

                <div class="form-group">
                    <label class="form-label" for="clientNotes">Заметки</label>
                    <textarea id="clientNotes" class="form-input" rows="4"></textarea>
                </div>

                <button type="submit" class="btn btn-register">
                    Добавить психолога
                </button>
            </form>
        </div>

        <div class="tab-content" id="specialistProfileTab">
            <h2>Мой профиль</h2>
            <form id="specialistProfileForm">
                <div class="form-group">
                    <label class="form-label" for="specialistProfileName">Имя и фамилия</label>
                    <input type="text" id="specialistProfileName" class="form-input" value="Мария Петрова" />
                </div>

                <div class="form-group">
                    <label class="form-label" for="specialistProfileEmail">Email</label>
                    <input type="email" id="specialistProfileEmail" class="form-input" value="petrova@example.com"
                        readonly />
                </div>

                <div class="form-group">
                    <label class="form-label" for="specialistProfileSpecialty">Специализация</label>
                    <select id="specialistProfileSpecialty" class="form-input">
                        <option value="Супервизия для семейных психологов">Супервизия для семейных психологов</option>
                        <option value="Супервизия для детских психологов">Супервизия для детских психологов</option>
                        <option value="Клиническая супервизия" selected>Клиническая супервизия</option>
                        <option value="Супервизия для нейропсихологов">Супервизия для нейропсихологов</option>
                    </select>
                </div>

                <div class="form-group">
                    <label class="form-label" for="specialistProfileExperience">Опыт работы (лет)</label>
                    <input type="number" id="specialistProfileExperience" class="form-input" value="7" min="0" />
                </div>

                <div class="form-group">
                    <label class="form-label" for="specialistProfileEducation">Образование</label>
                    <textarea id="specialistProfileEducation" class="form-input"
                        rows="3">МГУ, факультет психологии</textarea>
                </div>

                <div class="form-group">
                    <label class="form-label" for="specialistProfileDescription">О себе</label>
                    <textarea id="specialistProfileDescription" class="form-input"
                        rows="4">Специализируюсь на супервизии для психологов с тревожными расстройствами и депрессией. Использую методы КПТ и гештальт-терапии.</textarea>
                </div>

                <div class="form-group">
                    <label class="form-label" for="specialistProfilePrice">Цена за сессию (руб.)</label>
                    <input type="number" id="specialistProfilePrice" class="form-input" value="3500" min="0" />
                </div>

                <div class="form-group">
                    <label class="form-label" for="specialistProfilePhoto">Фото профиля</label>
                    <input type="file" id="specialistProfilePhoto" class="form-input" accept="image/*">
                    <img id="specialistPhotoPreview" class="media-preview" style="display: none;">
                </div>

                <div class="form-group">
                    <label class="form-label" for="specialistProfileVideo">Видео профиля</label>
                    <input type="file" id="specialistProfileVideo" class="form-input" accept="video/*">
                    <video id="specialistVideoPreview" class="video-preview" style="display: none;" controls></video>
                </div>

                <button type="submit" class="btn btn-register">
                    Сохранить изменения
                </button>
            </form>
        </div>
    </section>

    <!-- Модальное окно для полного профиля психолога (клиента) -->
    <div class="modal-overlay client-detail-modal" id="clientDetailModal">
        <div class="modal modal-wide client-full-profile">
            <span class="modal-close" data-modal="clientDetailModal">&times;</span>
            <h2 class="modal-title" id="clientDetailTitle">Профиль психолога</h2>
            <div id="clientFullProfileContent">
                <!-- Содержимое профиля будет добавляться через JS -->
            </div>
        </div>
    </div>

    <!-- Модальное окно для полного профиля супервизора (в кабинете психолога) -->
    <div class="modal-overlay specialist-detail-modal" id="specialistDetailModal">
        <div class="modal modal-wide specialist-full-profile">
            <span class="modal-close" data-modal="specialistDetailModal">&times;</span>
            <h2 class="modal-title" id="specialistDetailTitle">Профиль супервизора</h2>
            <div id="specialistFullProfileContent">
                <!-- Содержимое профиля будет добавляться через JS -->
            </div>
        </div>
    </div>

    <!-- Модальное окно для заметок супервизора -->
    <div class="modal-overlay notes-modal" id="notesModal">
        <div class="modal">
            <span class="modal-close" data-modal="notesModal">&times;</span>
            <h2 class="modal-title" id="notesTitle">Заметки для психолога</h2>
            <div class="notes-list" id="notesList">
                <!-- Заметки будут добавляться через JS -->
            </div>
            <form id="notesForm" class="notes-form">
                <div class="form-group">
                    <label class="form-label" for="noteContent">Описание сессии, чувств и эмоций психолога</label>
                    <textarea id="noteContent" class="form-input"
                        placeholder="Опишите ключевые моменты сессии, наблюдаемые эмоции и прогресс..."
                        required></textarea>
                </div>
                <div class="form-group problem-selector">
                    <label class="form-label">Основная проблема психолога</label>
                    <div>
                        <div class="problem-option selected" data-problem="Эмоциональное выгорание">Эмоциональное
                            выгорание</div>
                        <div class="problem-option" data-problem="Этические дилеммы">Этические дилеммы</div>
                        <div class="problem-option" data-problem="Тревога и стресс">Тревога и стресс</div>
                        <div class="problem-option" data-problem="Самооценка">Самооценка</div>
                        <div class="problem-option" data-problem="Другое">Другое</div>
                    </div>
                </div>
                <div class="form-group request-selector">
                    <label class="form-label">Выявленный ключевой запрос</label>
                    <div>
                        <div class="request-option selected" data-request="Развитие личности">Развитие личности</div>
                        <div class="request-option" data-request="Семейные отношения">Семейные отношения</div>
                        <div class="request-option" data-request="Карьерный рост">Карьерный рост</div>
                        <div class="request-option" data-request="Здоровье и благополучие">Здоровье и благополучие</div>
                        <div class="request-option" data-request="Другое">Другое</div>
                    </div>
                </div>
                <button type="submit" class="btn btn-register">
                    Добавить заметку
                </button>
            </form>
        </div>
    </div>

    <!-- Модальное окно для записи на сессию (подтверждение) -->
    <div class="modal-overlay booking-modal" id="bookingModal">
        <div class="modal">
            <span class="modal-close" data-modal="bookingModal">&times;</span>
            <h2 class="modal-title">Запись на сессию супервизии</h2>
            <div class="booking-summary" id="bookingSummary">
                <!-- Информация о записи будет добавляться через JS -->
            </div>
            <form id="bookingForm">
                <div class="form-group">
                    <label class="form-label" for="bookingNotes">Ваши пожелания или вопросы</label>
                    <textarea id="bookingNotes" class="form-input" rows="3"
                        placeholder="Опишите, с какой проблемой вы хотите обратиться..."></textarea>
                </div>
                <button type="submit" class="btn btn-register" style="width: 100%">
                    Подтвердить запись
                </button>
            </form>
        </div>
    </div>

    <!-- Модальное окно записи психолога (супервизор) -->
    <div class="modal-overlay modal-large" id="bookClientModal">
        <div class="modal modal-large">
            <span class="modal-close" data-modal="bookClientModal">&times;</span>
            <h2 class="modal-title">Записать психолога</h2>
            <div class="calendar-container" id="bookCalendarContainer">
                <div class="calendar-header">
                    <h3 id="bookCalendarMonth"></h3>
                    <div>
                        <button class="btn btn-login" id="bookPrevMonth"><i class="fas fa-chevron-left"></i></button>
                        <button class="btn btn-login" id="bookNextMonth"><i class="fas fa-chevron-right"></i></button>
                    </div>
                </div>
                <div class="calendar-grid" id="bookCalendarDays"></div>
                <div class="time-slots" id="bookTimeSlotsContainer"></div>
            </div>
            <button class="btn btn-register" id="confirmBookClient" style="width: 100%">Подтвердить запись</button>
        </div>
    </div>

    <!-- Модальное окно выбора для расписания -->
    <div class="modal-overlay" id="scheduleChoiceModal">
        <div class="modal">
            <span class="modal-close" data-modal="scheduleChoiceModal">&times;</span>
            <h2 class="modal-title">Что планируете на это время?</h2>
            <div style="display: flex; gap: 1rem; justify-content: center; margin-bottom: 1rem;">
                <button class="btn btn-register" id="bookClientChoice">Записать психолога</button>
                <button class="btn btn-login" id="otherPlanChoice">Другой план</button>
            </div>
        </div>
    </div>

    <!-- Модальное окно записи конкретного психолога из расписания -->
    <div class="modal-overlay" id="bookSpecificClientModal">
        <div class="modal">
            <span class="modal-close" data-modal="bookSpecificClientModal">&times;</span>
            <h2 class="modal-title">Записать психолога на выбранное время</h2>
            <form id="bookSpecificClientForm">
                <div class="form-group">
                    <label class="form-label" for="selectClient">Выберите психолога</label>
                    <select id="selectClient" class="form-input" required>
                        <!-- Опции добавляются динамически -->
                    </select>
                </div>
                <div class="booking-summary" id="selectedSlotInfo">
                    <!-- Информация о слоте -->
                </div>
                <button type="submit" class="btn btn-register" style="width: 100%">Записать</button>
            </form>
        </div>
    </div>

    <!-- Модальное окно другого плана -->
    <div class="modal-overlay" id="otherPlanModal">
        <div class="modal">
            <span class="modal-close" data-modal="otherPlanModal">&times;</span>
            <h2 class="modal-title">Другой план</h2>
            <form id="otherPlanForm">
                <div class="form-group">
                    <label class="form-label" for="planTitle">Название плана</label>
                    <input type="text" id="planTitle" class="form-input" required />
                </div>
                <div class="form-group">
                    <label class="form-label" for="planDescription">Описание</label>
                    <textarea id="planDescription" class="form-input" rows="3" required></textarea>
                </div>
                <div class="booking-summary" id="selectedPlanSlotInfo">
                    <!-- Информация о слоте -->
                </div>
                <button type="submit" class="btn btn-register" style="width: 100%">Добавить план</button>
            </form>
        </div>
    </div>

    <!-- Модальное окно выбора даты/времени для психолога -->
    <div class="modal-overlay modal-large" id="clientBookingModal">
        <div class="modal modal-large">
            <span class="modal-close" data-modal="clientBookingModal">&times;</span>
            <h2 class="modal-title">Выберите дату и время</h2>
            <div class="calendar-container" id="clientCalendarContainer">
                <div class="calendar-header">
                    <h3 id="clientCalendarMonth"></h3>
                    <div>
                        <button class="btn btn-login" id="clientPrevMonth"><i class="fas fa-chevron-left"></i></button>
                        <button class="btn btn-login" id="clientNextMonth"><i class="fas fa-chevron-right"></i></button>
                    </div>
                </div>
                <div class="calendar-grid" id="clientCalendarDays"></div>
                <div class="time-slots" id="clientTimeSlotsContainer"></div>
            </div>
            <button class="btn btn-register" id="confirmClientTime" style="width: 100%">Далее</button>
        </div>
    </div>

    <!-- Модальное окно для переноса записи супервизором -->
    <div class="modal-overlay modal-large" id="rescheduleModal">
        <div class="modal modal-large">
            <span class="modal-close" data-modal="rescheduleModal">&times;</span>
            <h2 class="modal-title">Перенести сессию</h2>
            <div class="calendar-container" id="rescheduleCalendarContainer">
                <div class="calendar-header">
                    <h3 id="rescheduleCalendarMonth"></h3>
                    <div>
                        <button class="btn btn-login" id="reschedulePrevMonth"><i
                                class="fas fa-chevron-left"></i></button>
                        <button class="btn btn-login" id="rescheduleNextMonth"><i
                                class="fas fa-chevron-right"></i></button>
                    </div>
                </div>
                <div class="calendar-grid" id="rescheduleCalendarDays"></div>
                <div class="time-slots" id="rescheduleTimeSlotsContainer"></div>
            </div>
            <button class="btn btn-register" id="confirmReschedule" style="width: 100%">Подтвердить перенос</button>
        </div>
    </div>

    <!-- Контейнер для уведомлений -->
    <div class="notification-container" id="notificationContainer"></div>

    <!-- Индикатор загрузки -->
    <div class="loader-overlay" id="loaderOverlay">
        <div class="loader"></div>
    </div>

    <script>
        // Система хранения данных
        const Storage = {
            // Получение данных из localStorage
            get: (key) => {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : null;
            },

            // Сохранение данных в localStorage
            set: (key, data) => {
                localStorage.setItem(key, JSON.stringify(data));
            },

            // Удаление данных из localStorage
            remove: (key) => {
                localStorage.removeItem(key);
            },

            // Очистка всех данных
            clear: () => {
                localStorage.clear();
            },
        };

        // Ключи для хранения данных
        const STORAGE_KEYS = {
            USERS: "supervision_users",
            SPECIALISTS: "supervision_supervisors",
            APPOINTMENTS: "supervision_appointments",
            CLIENTS: "supervision_psychologists",
            JOURNALS: "supervision_journals",
            NOTES: "supervision_notes",
            CURRENT_USER: "supervision_current_user",
        };

        // Инициализация данных при первом запуске
        function initializeData() {
            // Проверяем, инициализированы ли уже данные
            if (!Storage.get(STORAGE_KEYS.USERS)) {
                // Создаем тестовых пользователей
                const users = [
                    {
                        id: 1,
                        name: "Алексей Козлов",
                        email: "psychologist@example.com",
                        password: "password123",
                        role: "client",
                        phone: "+7 (999) 123-45-67",
                        birthdate: "1990-05-15",
                        photo: "",
                        helpNeeded: "Выгорание",
                    },
                    {
                        id: 2,
                        name: "Мария Петрова",
                        email: "supervisor@example.com",
                        password: "password123",
                        role: "specialist",
                        specialty: "Клиническая супервизия",
                        experience: 7,
                        education: "МГУ, факультет психологии",
                        description:
                            "Специализируюсь на супервизии для психологов с тревожными расстройствами и депрессией. Использую методы КПТ и гештальт-терапии.",
                        price: 3500,
                        photo: "",
                        video: "",
                    },
                ];

                Storage.set(STORAGE_KEYS.USERS, users);
            }

            if (!Storage.get(STORAGE_KEYS.SPECIALISTS)) {
                // Создаем тестовых супервизоров
                const supervisors = [
                    {
                        id: 1,
                        name: "Мария Петрова",
                        specialty: "Клиническая супервизия",
                        experience: 7,
                        rating: 4.8,
                        reviews: 42,
                        price: 3500,
                        avatar: "https://randomuser.me/api/portraits/women/12.jpg",
                        description:
                            "Специализируюсь на супервизии для психологов с тревожными расстройствами и депрессией. Использую методы КПТ и гештальт-терапии.",
                        userId: 2,
                    },
                    {
                        id: 2,
                        name: "Иван Сидоров",
                        specialty: "Супервизия для семейных психологов",
                        experience: 5,
                        rating: 4.6,
                        reviews: 28,
                        price: 3000,
                        avatar: "https://randomuser.me/api/portraits/men/32.jpg",
                        description:
                            "Помогаю психологам наладить супервизию в отношениях, решить конфликты и улучшить взаимопонимание.",
                        userId: null,
                    },
                    {
                        id: 3,
                        name: "Ольга Иванова",
                        specialty: "Супервизия для детских психологов",
                        experience: 9,
                        rating: 4.9,
                        reviews: 56,
                        price: 4000,
                        avatar: "https://randomuser.me/api/portraits/women/45.jpg",
                        description:
                            "Работаю с психологами по супервизии детей и подростков. Помогаю решить проблемы поведения, обучения и социализации.",
                        userId: null,
                    },
                ];

                Storage.set(STORAGE_KEYS.SPECIALISTS, supervisors);
            }

            if (!Storage.get(STORAGE_KEYS.APPOINTMENTS)) {
                Storage.set(STORAGE_KEYS.APPOINTMENTS, []);
            }

            if (!Storage.get(STORAGE_KEYS.CLIENTS)) {
                Storage.set(STORAGE_KEYS.CLIENTS, []);
            }

            if (!Storage.get(STORAGE_KEYS.JOURNALS)) {
                Storage.set(STORAGE_KEYS.JOURNALS, []);
            }

            if (!Storage.get(STORAGE_KEYS.NOTES)) {
                Storage.set(STORAGE_KEYS.NOTES, []);
            }
        }

        // Данные для демонстрации
        let supervisorsData = [];
        let appointmentsData = [];
        let psychologistsData = [];
        let journalData = [];
        let notesData = [];

        // Календарные данные
        let currentMonth = new Date().getMonth();
        let currentYear = new Date().getFullYear();

        let bookings = {};

        // Текущий пользователь
        let currentUser = null;

        // Для заметок к записи
        let currentAppIdForNote = null;
        let isConducted = false;

        // Основной код приложения
        document.addEventListener("DOMContentLoaded", function () {
            // Инициализация данных
            initializeData();
            loadData();

            // Проверяем, есть ли активный пользователь
            const savedUser = Storage.get(STORAGE_KEYS.CURRENT_USER);
            if (savedUser) {
                currentUser = savedUser;
                if (currentUser.role === "specialist") {
                    showDashboard("specialist");
                } else {
                    showDashboard("client");
                }
            }

            // Мобильное меню
            const menuToggle = document.querySelector(".menu-toggle");
            const mobileMenu = document.querySelector(".mobile-menu");
            const menuOverlay = document.querySelector(".menu-overlay");
            const navItems = document.querySelectorAll(".mobile-menu .nav-item");
            const mobileLoginBtn = document.getElementById("mobileLoginBtn");
            const mobileRegisterBtn = document.getElementById("mobileRegisterBtn");
            const mobileLogoutBtn = document.getElementById("mobileLogoutBtn");

            function toggleMenu() {
                const isActive = mobileMenu.classList.toggle("active");
                menuOverlay.classList.toggle("active");
                const icon = menuToggle.querySelector("i");
                icon.classList.toggle("fa-bars");
                icon.classList.toggle("fa-times");

                // Показать/скрыть кнопки авторизации в зависимости от состояния пользователя
                if (currentUser) {
                    mobileMenu.querySelector(".nav-auth").style.display = "none";
                    mobileMenu.querySelector(".nav-logout").style.display = "flex";
                } else {
                    mobileMenu.querySelector(".nav-auth").style.display = "flex";
                    mobileMenu.querySelector(".nav-logout").style.display = "none";
                }
            }

            function closeMenu() {
                mobileMenu.classList.remove("active");
                menuOverlay.classList.remove("active");
                const icon = menuToggle.querySelector("i");
                icon.classList.add("fa-bars");
                icon.classList.remove("fa-times");
            }

            menuToggle.addEventListener("click", toggleMenu);
            menuOverlay.addEventListener("click", closeMenu);

            navItems.forEach((item) => {
                item.addEventListener("click", closeMenu);
            });

            if (mobileLoginBtn) {
                mobileLoginBtn.addEventListener("click", () => {
                    closeMenu();
                    openModal("loginModal");
                });
            }

            if (mobileRegisterBtn) {
                mobileRegisterBtn.addEventListener("click", () => {
                    closeMenu();
                    openModal("registerModal");
                });
            }

            if (mobileLogoutBtn) {
                mobileLogoutBtn.addEventListener("click", () => {
                    closeMenu();
                    logout();
                });
            }

            // Инициализация
            initModals();
            initAuth();
            initDashboard();
            initSupervisors();
            initCalendar();
            initNotifications();
            initNotes();
            initJournal();
            initBooking();
            initSpecialistAppointments();
            initBookPsychologist();
            initScheduleChoice();
            initPsychologistBookingModal();
            initRescheduleModal(); // Инициализация модала переноса

            // Анимация навигации при прокрутке
            window.addEventListener("scroll", function () {
                const navbar = document.querySelector(".navbar");
                if (window.scrollY > 50) {
                    navbar.classList.add("scrolled");
                } else {
                    navbar.classList.remove("scrolled");
                }

                // Анимация карточек при прокрутке
                const featureCards = document.querySelectorAll(".feature-card");
                const helpCards = document.querySelectorAll(".help-card");
                animateOnScroll(featureCards, "animate");
                animateOnScroll(helpCards, "animate");
            });

            // Функция для анимации при прокрутке
            function animateOnScroll(elements, className) {
                elements.forEach((element) => {
                    const position = element.getBoundingClientRect();
                    if (position.top < window.innerHeight - 100) {
                        element.classList.add(className);
                    }
                });
            }

            // Инициализация анимации при загрузке
            const featureCards = document.querySelectorAll(".feature-card");
            const helpCards = document.querySelectorAll(".help-card");
            animateOnScroll(featureCards, "animate");
            animateOnScroll(helpCards, "animate");

            // Плавная прокрутка для якорных ссылок
            document.querySelectorAll('a[href^="#"]').forEach((anchor) => {
                anchor.addEventListener("click", function (e) {
                    e.preventDefault();
                    const targetId = this.getAttribute("href");
                    if (targetId === "#") return;

                    const targetElement = document.querySelector(targetId);
                    if (targetElement) {
                        window.scrollTo({
                            top: targetElement.offsetTop - 80,
                            behavior: "smooth",
                        });

                        // Закрыть мобильное меню после клика
                        if (mobileMenu.classList.contains("active")) {
                            closeMenu();
                        }
                    }
                });
            });
        });

        // Загрузка данных из хранилища
        function loadData() {
            supervisorsData = Storage.get(STORAGE_KEYS.SPECIALISTS) || [];
            appointmentsData = Storage.get(STORAGE_KEYS.APPOINTMENTS) || [];
            journalData = Storage.get(STORAGE_KEYS.JOURNALS) || [];
            notesData = Storage.get(STORAGE_KEYS.NOTES) || [];

            // Обновляем bookings из appointmentsData
            updateBookingsFromAppointments();
        }

        // Обновление данных о бронированиях из appointmentsData
        function updateBookingsFromAppointments() {
            bookings = {};

            appointmentsData.forEach((appointment) => {
                if (
                    appointment.status !== "cancelled" &&
                    appointment.status !== "completed"
                ) {
                    const supervisorId = appointment.specialistId;
                    if (!bookings[supervisorId]) bookings[supervisorId] = {};
                    const dateKey = `${appointment.dateYear}-${appointment.dateMonth}-${appointment.dateDay}`;
                    if (!bookings[supervisorId][dateKey]) bookings[supervisorId][dateKey] = {};
                    bookings[supervisorId][dateKey][appointment.time] = appointment.type === "plan" ? `План: ${appointment.planTitle}` : appointment.clientName;
                }
            });
        }

        // Инициализация модальных окон
        function initModals() {
            // Открытие модальных окон
            document.getElementById("loginBtn").addEventListener("click", () => {
                openModal("loginModal");
            });

            document.getElementById("registerBtn").addEventListener("click", () => {
                openModal("registerModal");
            });

            // Закрытие модальных окон
            document.querySelectorAll(".modal-close").forEach((closeBtn) => {
                closeBtn.addEventListener("click", function () {
                    const modalId = this.getAttribute("data-modal");
                    closeModal(modalId);
                    if (modalId === "appointmentNotesChoiceModal") {
                        currentAppIdForNote = null;
                    }
                    if (modalId === "appointmentNoteModal") {
                        currentAppIdForNote = null;
                        isConducted = false;
                    }
                });
            });

            // Переключение между модальными окнами
            document.querySelectorAll(".form-link").forEach((link) => {
                link.addEventListener("click", function () {
                    const fromModal = this.getAttribute("data-from");
                    const toModal = this.getAttribute("data-to");
                    closeModal(fromModal);
                    openModal(toModal);
                });
            });

            // Выбор роли при регистрации
            document.querySelectorAll(".role-option").forEach((option) => {
                option.addEventListener("click", function () {
                    document.querySelectorAll(".role-option").forEach((opt) => {
                        opt.classList.remove("selected");
                    });
                    this.classList.add("selected");
                    document.getElementById("userRole").value =
                        this.getAttribute("data-role");
                });
            });

            // Обработка форм
            document
                .getElementById("loginForm")
                .addEventListener("submit", function (e) {
                    e.preventDefault();
                    handleLogin();
                });

            document
                .getElementById("registerForm")
                .addEventListener("submit", function (e) {
                    e.preventDefault();
                    handleRegistration();
                });

            // Опрос
            document.getElementById("surveyForm").addEventListener("submit", handleSurvey);

            // Оценка занятия
            // Обработчики для всех .emotion-btn в модалах (rateSession и appointmentNote)
            document.addEventListener("click", function (e) {
                if (e.target.classList.contains("emotion-btn")) {
                    e.target.classList.toggle("selected");
                }
            });

            document.getElementById("rateSessionForm").addEventListener("submit", handleRateSession);

            // Опции опроса
            document.addEventListener("click", function (e) {
                if (e.target.classList.contains("survey-option")) {
                    e.target.closest(".modal").querySelectorAll(".survey-option").forEach(opt => opt.classList.remove("selected"));
                    e.target.classList.add("selected");
                    e.target.querySelector("input").checked = true;
                }
            });

            // Проблемы и запросы в заметках
            document.addEventListener("click", function (e) {
                if (e.target.classList.contains("problem-option")) {
                    e.target.closest(".modal").querySelectorAll(".problem-option").forEach(opt => opt.classList.remove("selected"));
                    e.target.classList.add("selected");
                }
                if (e.target.classList.contains("request-option")) {
                    e.target.closest(".modal").querySelectorAll(".request-option").forEach(opt => opt.classList.remove("selected"));
                    e.target.classList.add("selected");
                }
            });

            // Эмоции в заметках (emotion-option в notesModal)
            document.addEventListener("click", function (e) {
                if (e.target.classList.contains("emotion-option")) {
                    e.target.classList.toggle("selected");
                }
            });

            // Заметки к записи - выбор
            document.getElementById("sessionNoteBtn").addEventListener("click", () => {
                isConducted = false;
                openAppointmentNoteModal(currentAppIdForNote);
                closeModal("appointmentNotesChoiceModal");
            });

            document.getElementById("conductedBtn").addEventListener("click", () => {
                isConducted = true;
                const appIndex = appointmentsData.findIndex(a => a.id == currentAppIdForNote);
                if (appIndex !== -1) {
                    appointmentsData[appIndex].status = "completed";
                    Storage.set(STORAGE_KEYS.APPOINTMENTS, appointmentsData);
                    updateBookingsFromAppointments();
                    renderAppointments();
                }
                openAppointmentNoteModal(currentAppIdForNote);
                closeModal("appointmentNotesChoiceModal");
            });

            // Форма заметки к записи
            document.getElementById("appointmentNoteForm").addEventListener("submit", (e) => {
                e.preventDefault();
                const content = document.getElementById("noteContent").value;
                const problemInput = document.querySelector('#appointmentNoteModal input[name="noteProblem"]:checked');
                const requestInput = document.querySelector('#appointmentNoteModal input[name="noteRequest"]:checked');
                const problem = problemInput ? problemInput.value : "";
                const request = requestInput ? requestInput.value : "";
                const app = appointmentsData.find(a => a.id == currentAppIdForNote);
                let noteDate;
                let noteContent;
                if (isConducted && app) {
                    noteDate = `${app.dateDay} ${getMonthName(app.dateMonth - 1)} ${app.dateYear}`;
                    noteContent = `Сессия проведена с ${app.specialistName}. ${problem ? `Проблема: ${problem}. ` : ''}${request ? `Запрос: ${request}. ` : ''}${content}`;
                } else {
                    noteDate = new Date().toLocaleDateString("ru-RU");
                    noteContent = `${problem ? `Проблема: ${problem}. ` : ''}${request ? `Запрос: ${request}. ` : ''}${content}`;
                }
                const newEntry = {
                    id: Date.now(),
                    userId: currentUser.id,
                    date: noteDate,
                    content: noteContent,
                    createdAt: new Date().toISOString(),
                };
                const journals = Storage.get(STORAGE_KEYS.JOURNALS) || [];
                journals.push(newEntry);
                Storage.set(STORAGE_KEYS.JOURNALS, journals);
                journalData = Storage.get(STORAGE_KEYS.JOURNALS) || []; // Reload global
                // Reset
                document.getElementById("noteContent").value = "";
                document.querySelectorAll("#appointmentNoteModal .survey-option").forEach(o => o.classList.remove("selected"));
                currentAppIdForNote = null;
                isConducted = false;
                closeModal("appointmentNoteModal");
                showNotification("Заметка добавлена в дневник", "success");
            });
        }

        // Открытие модального окна заметки к записи
        function openAppointmentNoteModal(appId) {
            currentAppIdForNote = appId;
            openModal("appointmentNoteModal");
        }

        // Открытие модального окна
        function openModal(modalId) {
            document.getElementById(modalId).classList.add("active");
            document.body.style.overflow = "hidden";
        }

        // Закрытие модального окна
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove("active");
            document.body.style.overflow = "auto";
        }

        // Обработка входа
        function handleLogin() {
            showLoader();

            const email = document.getElementById("loginEmail").value;
            const password = document.getElementById("loginPassword").value;
            let isValid = true;

            // Валидация email
            if (!validateEmail(email)) {
                document.getElementById("loginEmailError").classList.add("show");
                isValid = false;
            } else {
                document.getElementById("loginEmailError").classList.remove("show");
            }

            // Валидация пароля
            if (password.length < 6) {
                document.getElementById("loginPasswordError").classList.add("show");
                isValid = false;
            } else {
                document
                    .getElementById("loginPasswordError")
                    .classList.remove("show");
            }

            if (!isValid) {
                hideLoader();
                showNotification("Пожалуйста, исправьте ошибки в форме", "error");
                return;
            }

            // Поиск пользователя в базе
            const users = Storage.get(STORAGE_KEYS.USERS) || [];
            const user = users.find(
                (u) => u.email === email && u.password === password
            );

            if (!user) {
                hideLoader();
                showNotification("Неверный email или пароль", "error");
                return;
            }

            // Сохраняем текущего пользователя
            currentUser = user;
            Storage.set(STORAGE_KEYS.CURRENT_USER, user);

            // Имитация запроса к серверу
            setTimeout(() => {
                hideLoader();
                closeModal("loginModal");
                if (user.role === "client" && !user.helpNeeded) {
                    openModal("surveyModal");
                } else {
                    if (user.role === "specialist") {
                        showDashboard("specialist");
                    } else {
                        showDashboard("client");
                    }
                    showNotification("Вход выполнен успешно!", "success");
                }
            }, 500);
        }

        // Обработка регистрации
        function handleRegistration() {
            showLoader();

            const name = document.getElementById("registerName").value;
            const email = document.getElementById("registerEmail").value;
            const password = document.getElementById("registerPassword").value;
            const confirmPassword = document.getElementById(
                "registerConfirmPassword"
            ).value;
            const role = document.getElementById("userRole").value;

            let isValid = true;

            // Валидация имени
            if (name.trim() === "") {
                document.getElementById("registerNameError").classList.add("show");
                isValid = false;
            } else {
                document.getElementById("registerNameError").classList.remove("show");
            }

            // Валидация email
            if (!validateEmail(email)) {
                document.getElementById("registerEmailError").classList.add("show");
                isValid = false;
            } else {
                document
                    .getElementById("registerEmailError")
                    .classList.remove("show");
            }

            // Валидация пароля
            if (password.length < 6) {
                document
                    .getElementById("registerPasswordError")
                    .classList.add("show");
                isValid = false;
            } else {
                document
                    .getElementById("registerPasswordError")
                    .classList.remove("show");
            }

            // Проверка совпадения паролей
            if (password !== confirmPassword) {
                document
                    .getElementById("registerConfirmPasswordError")
                    .classList.add("show");
                isValid = false;
            } else {
                document
                    .getElementById("registerConfirmPasswordError")
                    .classList.remove("show");
            }

            if (!isValid) {
                hideLoader();
                showNotification("Пожалуйста, исправьте ошибки в форме", "error");
                return;
            }

            // Проверяем, нет ли уже пользователя с таким email
            const users = Storage.get(STORAGE_KEYS.USERS) || [];
            if (users.find((u) => u.email === email)) {
                hideLoader();
                showNotification(
                    "Пользователь с таким email уже существует",
                    "error"
                );
                return;
            }

            // Создаем нового пользователя
            const newUser = {
                id: Date.now(),
                name,
                email,
                password,
                role,
                phone: "",
                birthdate: "",
                photo: "",
                helpNeeded: role === "client" ? null : undefined,
            };

            users.push(newUser);
            Storage.set(STORAGE_KEYS.USERS, users);

            // Если это супервизор, создаем запись в таблице супервизоров
            if (role === "specialist") {
                const supervisors = Storage.get(STORAGE_KEYS.SPECIALISTS) || [];
                const newSupervisor = {
                    id: Date.now(),
                    name,
                    specialty: "Клиническая супервизия",
                    experience: 0,
                    rating: 0,
                    reviews: 0,
                    price: 3000,
                    avatar:
                        "https://randomuser.me/api/portraits/" +
                        (Math.random() > 0.5 ? "men" : "women") +
                        "/" +
                        Math.floor(Math.random() * 50) +
                        ".jpg",
                    description: "Новый супервизор",
                    userId: newUser.id,
                };

                supervisors.push(newSupervisor);
                Storage.set(STORAGE_KEYS.SPECIALISTS, supervisors);
            }

            // Сохраняем текущего пользователя
            currentUser = newUser;
            Storage.set(STORAGE_KEYS.CURRENT_USER, newUser);

            setTimeout(() => {
                hideLoader();
                closeModal("registerModal");
                if (role === "client") {
                    openModal("surveyModal");
                } else {
                    showDashboard("specialist");
                    showNotification("Регистрация прошла успешно!", "success");
                }
            }, 500);
        }

        // Обработка опроса
        function handleSurvey(e) {
            e.preventDefault();
            const selectedOption = document.querySelector('.survey-option.selected');
            if (!selectedOption) {
                showNotification("Выберите вариант", "error");
                return;
            }
            const selectedProblem = selectedOption.querySelector('input').value;
            const users = Storage.get(STORAGE_KEYS.USERS) || [];
            const userIndex = users.findIndex(u => u.id === currentUser.id);
            if (userIndex !== -1) {
                users[userIndex].helpNeeded = selectedProblem;
                Storage.set(STORAGE_KEYS.USERS, users);
                currentUser.helpNeeded = selectedProblem;
                Storage.set(STORAGE_KEYS.CURRENT_USER, currentUser);
            }
            closeModal("surveyModal");
            showDashboard("client");
            showNotification("Опрос завершен! Добро пожаловать в кабинет.", "success");
        }

        // Валидация email
        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

        // Показать/скрыть личный кабинет
        function showDashboard(type) {
            document.getElementById("main-content").style.display = "none";
            document.querySelector(".features").style.display = "none";
            document.querySelector(".help").style.display = "none";
            document.querySelector(".footer").style.display = "none";

            if (type === "client") {
                document.getElementById("clientDashboard").style.display = "block";
                document.getElementById("specialistDashboard").style.display = "none";
                document.getElementById("clientName").textContent = currentUser.name;
                document.getElementById("clientProfileName").value = currentUser.name;
                document.getElementById("clientProfileEmail").value =
                    currentUser.email;
                document.getElementById("clientProfilePhone").value =
                    currentUser.phone || "";
                document.getElementById("clientProfileBirthdate").value =
                    currentUser.birthdate || "";
                if (currentUser.photo) {
                    document.getElementById("clientPhotoPreview").src = currentUser.photo;
                    document.getElementById("clientPhotoPreview").style.display = "block";
                }
                loadUserAppointments();
                renderAppointments();
                loadUserJournal();
                renderJournal();
                renderSupervisors();
                // Проверяем новые записи (pending)
                checkForNewAppointmentsPsychologist();
            } else {
                document.getElementById("clientDashboard").style.display = "none";
                document.getElementById("specialistDashboard").style.display = "block";
                const supervisors = Storage.get(STORAGE_KEYS.SPECIALISTS) || [];
                const supervisor = supervisors.find(
                    (s) => s.userId === currentUser.id
                );
                if (supervisor) {
                    document.getElementById("specialistName").textContent =
                        supervisor.name;
                    document.getElementById("specialistProfileName").value =
                        supervisor.name;
                    document.getElementById("specialistProfileEmail").value =
                        currentUser.email;
                    document.getElementById("specialistProfileSpecialty").value =
                        supervisor.specialty || "Клиническая супервизия";
                    document.getElementById("specialistProfileExperience").value =
                        supervisor.experience || 0;
                    document.getElementById("specialistProfileEducation").value =
                        supervisor.education || "";
                    document.getElementById("specialistProfileDescription").value =
                        supervisor.description || "";
                    document.getElementById("specialistProfilePrice").value =
                        supervisor.price || 3000;
                    if (supervisor.photo) {
                        document.getElementById("specialistPhotoPreview").src = supervisor.photo;
                        document.getElementById("specialistPhotoPreview").style.display = "block";
                    }
                    if (supervisor.video) {
                        document.getElementById("specialistVideoPreview").src = supervisor.video;
                        document.getElementById("specialistVideoPreview").style.display = "block";
                    }
                }
                loadSupervisorPsychologists();
                renderPsychologists();
                renderCalendar();
                // Проверяем новые запросы на запись (pending)
                checkForNewAppointmentsSupervisor();
            }

            // Обновляем видимость элементов навигации
            document.querySelector(".nav-auth").style.display = "none";
            document.querySelector(".nav-logout").style.display = "flex";
            if (type === "specialist") {
              document.querySelectorAll(".mobile-menu .nav-item").forEach(item => item.style.display = "none");
            }
            window.scrollTo(0, 0);
        }

        // Загрузка сессий пользователя (global all)
        function loadUserAppointments() {
            appointmentsData = Storage.get(STORAGE_KEYS.APPOINTMENTS) || [];
        }

        // Загрузка дневника пользователя (global all)
        function loadUserJournal() {
            journalData = Storage.get(STORAGE_KEYS.JOURNALS) || [];
        }

        // Проверка новых сессий для психолога (pending от супервизора)
        function checkForNewAppointmentsPsychologist() {
            const newAppointments = appointmentsData.filter(a => a.clientId === currentUser.id && a.status === "pending" && a.creatorRole === "specialist" && !a.seenByClient);
            if (newAppointments.length > 0) {
                newAppointments.forEach(app => {
                    showNotificationNewAppointmentPsychologist(app);
                    app.seenByClient = true;
                });
                Storage.set(STORAGE_KEYS.APPOINTMENTS, appointmentsData);
            }
        }

        // Показ уведомления новой сессии для психолога
        function showNotificationNewAppointmentPsychologist(appointment) {
            const notification = createNewAppointmentNotification(
                appointment,
                "client",
                "Супервизор предлагает сессию супервизии!"
            );
            const container = document.getElementById("notificationContainer");
            container.appendChild(notification);
            setTimeout(() => notification.classList.add("show"), 100);
            setTimeout(() => {
                notification.classList.remove("show");
                notification.classList.add("hide");
                setTimeout(() => container.removeChild(notification), 300);
            }, 7000);
        }

        // Проверка новых запросов для супервизора (pending от психолога)
        function checkForNewAppointmentsSupervisor() {
            const mySupervisor = supervisorsData.find(s => s.userId === currentUser.id);
            const newRequests = appointmentsData.filter(a => a.specialistId === mySupervisor.id && a.status === "pending" && a.creatorRole === "client" && !a.seenBySpecialist);
            if (newRequests.length > 0) {
                newRequests.forEach(app => {
                    showNotificationNewAppointmentSupervisor(app);
                    app.seenBySpecialist = true;
                });
                Storage.set(STORAGE_KEYS.APPOINTMENTS, appointmentsData);
            }
        }

        // Показ уведомления новой сессии для супервизора
        function showNotificationNewAppointmentSupervisor(appointment) {
            const notification = createNewAppointmentNotification(
                appointment,
                "specialist",
                "Психолог запрашивает сессию супервизии!"
            );
            const container = document.getElementById("notificationContainer");
            container.appendChild(notification);
            setTimeout(() => notification.classList.add("show"), 100);
            setTimeout(() => {
                notification.classList.remove("show");
                notification.classList.add("hide");
                setTimeout(() => container.removeChild(notification), 300);
            }, 7000);
        }

        // Создание уведомления новой сессии
        function createNewAppointmentNotification(appointment, role, message) {
            const notification = document.createElement("div");
            notification.className = `notification new-appointment`;

            const icon = role === "specialist" ? "user-plus" : "calendar-check";
            const actionText = role === "client" ? "Записаться" : "Записать";
            const declineText = role === "client" ? "Не записываться" : "Не записывать";

            notification.innerHTML = `
          <i class="fas fa-${icon} notification-icon"></i>
          <div>
            <div class="notification-message">${message}</div>
            <div style="margin-top: 0.5rem;">
              <strong>${role === "specialist" ? appointment.clientName : appointment.specialistName}</strong> - ${appointment.dateDay}.${appointment.dateMonth}.${appointment.dateYear} ${appointment.time}
            </div>
            <div class="client-actions" style="margin-top: 0.5rem; gap: 0.5rem;">
              <button class="btn btn-register" onclick="handleAppointmentAction(${appointment.id}, 'confirm')" style="padding: 0.3rem 0.8rem; font-size: 0.8rem;">${actionText}</button>
              <button class="btn btn-login" onclick="handleAppointmentAction(${appointment.id}, 'decline')" style="padding: 0.3rem 0.8rem; font-size: 0.8rem;">${declineText}</button>
            </div>
          </div>
        `;

            return notification;
        }

        // Обработка действий с новой сессией (confirm/decline)
        function handleAppointmentAction(appId, action) {
            const appIndex = appointmentsData.findIndex(a => a.id === appId);
            if (appIndex === -1) return;

            const app = appointmentsData[appIndex];
            const otherUserId = app.clientId === currentUser.id ? app.specialistId : app.clientId;
            const otherUserName = app.clientId === currentUser.id ? app.specialistName : app.clientName;

            if (action === "confirm") {
                app.status = "confirmed";
                Storage.set(STORAGE_KEYS.APPOINTMENTS, appointmentsData);
                updateBookingsFromAppointments();
                showNotification(`Сессия с ${otherUserName} подтверждена`, "success");

                // Уведомление другому пользователю (симуляция)
                setTimeout(() => {
                    if (currentUser.role === "client") {
                        showNotification("Вы записались на сессию!", "success");
                    } else {
                        showNotification(`Психолог ${otherUserName} записан!`, "success");
                    }
                }, 1000);

                // Обновляем виды
                if (currentUser.role === "client") {
                    loadUserAppointments();
                    renderAppointments();
                } else {
                    renderAllAppointments();
                    renderCalendar();
                }
            } else if (action === "decline") {
                app.status = "cancelled";
                Storage.set(STORAGE_KEYS.APPOINTMENTS, appointmentsData);
                updateBookingsFromAppointments();
                showNotification(`Сессия с ${otherUserName} отклонена`, "error");

                // Уведомление другому пользователю
                setTimeout(() => {
                    if (currentUser.role === "client") {
                        showNotification("Вы отказались от сессии", "error");
                    } else {
                        showNotification(`Запрос от ${otherUserName} отклонен`, "error");
                    }
                }, 1000);

                // Обновляем виды
                if (currentUser.role === "client") {
                    loadUserAppointments();
                    renderAppointments();
                } else {
                    renderAllAppointments();
                    renderCalendar();
                }
            }

            // Закрыть уведомление
            const notifications = document.querySelectorAll(".notification.new-appointment");
            notifications.forEach(n => {
                n.classList.remove("show");
                n.classList.add("hide");
                setTimeout(() => n.remove(), 300);
            });
        }

        // Загрузка психологов супервизора
        function loadSupervisorPsychologists() {
            const users = Storage.get(STORAGE_KEYS.USERS) || [];
            const links = Storage.get(STORAGE_KEYS.CLIENTS) || [];
            const myLinks = links.filter(link => link.specialistId === currentUser.id);
            psychologistsData = myLinks.map(link => {
                const user = users.find(u => u.id === link.id && u.role === "client");
                if (user) {
                    user.initialNotes = link.notes || "";
                }
                return user;
            }).filter(u => u);

            // Добавляем информацию о записях
            const appointments = Storage.get(STORAGE_KEYS.APPOINTMENTS) || [];

            psychologistsData.forEach((psychologist) => {
                const psychologistAppointments = appointments.filter(
                    (a) => a.clientId === psychologist.id && a.status === "confirmed" && a.type === "client"
                ).sort((a, b) => {
                    const dateA = new Date(a.dateYear, a.dateMonth - 1, a.dateDay, parseInt(a.time.split(':')[0]), parseInt(a.time.split(':')[1]));
                    const dateB = new Date(b.dateYear, b.dateMonth - 1, b.dateDay, parseInt(b.time.split(':')[0]), parseInt(b.time.split(':')[1]));
                    return dateA - dateB;
                });
                psychologist.nextSession =
                    psychologistAppointments.length > 0
                        ? formatAppointmentDate(psychologistAppointments[0])
                        : "Нет запланированных сессий";

                // Загружаем заметки для психолога
                psychologist.notes = notesData.filter((n) => n.clientId === psychologist.id);
            });
        }

        // Форматирование даты сессии
        function formatAppointmentDate(appointment) {
            const months = [
                "января",
                "февраля",
                "марта",
                "апреля",
                "мая",
                "июня",
                "июля",
                "августа",
                "сентября",
                "октября",
                "ноября",
                "декабря",
            ];
            return `${appointment.dateDay} ${months[appointment.dateMonth - 1]} ${appointment.dateYear
                }, ${appointment.time}`;
        }

        // Инициализация личного кабинета
        function initAuth() {
            // Выход из системы
            document.getElementById("navLogoutBtn").addEventListener("click", function () {
                logout();
            });

            // Переключение вкладок в кабинете психолога
            document
                .querySelectorAll("#clientDashboard .tab-btn")
                .forEach((btn) => {
                    btn.addEventListener("click", function () {
                        const tabId = this.getAttribute("data-tab");
                        switchPsychologistTab(tabId);
                    });
                });

            // Переключение вкладок в кабинете супервизора
            document
                .querySelectorAll("#specialistDashboard .tab-btn")
                .forEach((btn) => {
                    btn.addEventListener("click", function () {
                        const tabId = this.getAttribute("data-tab");
                        switchSupervisorTab(tabId);
                    });
                });

            // Сохранение профиля психолога
            document
                .getElementById("clientProfileForm")
                .addEventListener("submit", function (e) {
                    e.preventDefault();
                    savePsychologistProfile();
                });

            // Сохранение профиля супервизора
            document
                .getElementById("specialistProfileForm")
                .addEventListener("submit", function (e) {
                    e.preventDefault();
                    saveSupervisorProfile();
                });

            // Добавление психолога
            document
                .getElementById("addClientForm")
                .addEventListener("submit", function (e) {
                    e.preventDefault();
                    addPsychologist();
                });

            // Фото психолога
            document.getElementById("clientProfilePhoto").addEventListener("change", handlePsychologistPhotoUpload);

            // Фото и видео супервизора
            document.getElementById("specialistProfilePhoto").addEventListener("change", handleSupervisorPhotoUpload);
            document.getElementById("specialistProfileVideo").addEventListener("change", handleSupervisorVideoUpload);
        }

        // Обработка фото психолога
        function handlePsychologistPhotoUpload(e) {
            const file = e.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    currentUser.photo = e.target.result;
                    document.getElementById("clientPhotoPreview").src = currentUser.photo;
                    document.getElementById("clientPhotoPreview").style.display = "block";
                };
                reader.readAsDataURL(file);
            }
        }

        // Обработка фото супервизора
        function handleSupervisorPhotoUpload(e) {
            const file = e.target.files[0];
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const supervisors = Storage.get(STORAGE_KEYS.SPECIALISTS) || [];
                    const supervisor = supervisors.find(s => s.userId === currentUser.id);
                    if (supervisor) {
                        supervisor.photo = e.target.result;
                        Storage.set(STORAGE_KEYS.SPECIALISTS, supervisors);
                        document.getElementById("specialistPhotoPreview").src = supervisor.photo;
                        document.getElementById("specialistPhotoPreview").style.display = "block";
                    }
                };
                reader.readAsDataURL(file);
            }
        }

        // Обработка видео супервизора
        function handleSupervisorVideoUpload(e) {
            const file = e.target.files[0];
            if (file && file.type.startsWith('video/')) {
                const reader = new FileReader();
                reader.onload = function (e) {
                    const supervisors = Storage.get(STORAGE_KEYS.SPECIALISTS) || [];
                    const supervisor = supervisors.find(s => s.userId === currentUser.id);
                    if (supervisor) {
                        supervisor.video = e.target.result;
                        Storage.set(STORAGE_KEYS.SPECIALISTS, supervisors);
                        document.getElementById("specialistVideoPreview").src = supervisor.video;
                        document.getElementById("specialistVideoPreview").style.display = "block";
                    }
                };
                reader.readAsDataURL(file);
            }
        }

        // Сохранение профиля психолога
        function savePsychologistProfile() {
            showLoader();

            const name = document.getElementById("clientProfileName").value;
            const phone = document.getElementById("clientProfilePhone").value;
            const birthdate = document.getElementById(
                "clientProfileBirthdate"
            ).value;

            // Обновляем данные пользователя
            const users = Storage.get(STORAGE_KEYS.USERS) || [];
            const userIndex = users.findIndex((u) => u.id === currentUser.id);

            if (userIndex !== -1) {
                users[userIndex].name = name;
                users[userIndex].phone = phone;
                users[userIndex].birthdate = birthdate;
                users[userIndex].photo = currentUser.photo;

                Storage.set(STORAGE_KEYS.USERS, users);

                // Обновляем данные
                currentUser = users[userIndex];
                Storage.set(STORAGE_KEYS.CURRENT_USER, currentUser);

                document.getElementById("clientName").textContent = name;
            }

            setTimeout(() => {
                hideLoader();
                showNotification("Профиль успешно обновлен", "success");
            }, 500);
        }

        // Сохранение профиля супервизора
        function saveSupervisorProfile() {
            showLoader();

            const name = document.getElementById("specialistProfileName").value;
            const specialty = document.getElementById(
                "specialistProfileSpecialty"
            ).value;
            const experience = document.getElementById(
                "specialistProfileExperience"
            ).value;
            const education = document.getElementById(
                "specialistProfileEducation"
            ).value;
            const description = document.getElementById(
                "specialistProfileDescription"
            ).value;
            const price = document.getElementById("specialistProfilePrice").value;

            // Обновляем данные пользователя
            const users = Storage.get(STORAGE_KEYS.USERS) || [];
            const userIndex = users.findIndex((u) => u.id === currentUser.id);

            if (userIndex !== -1) {
                users[userIndex].name = name;
                Storage.set(STORAGE_KEYS.USERS, users);

                // Обновляем текущего пользователя
                currentUser = users[userIndex];
                Storage.set(STORAGE_KEYS.CURRENT_USER, currentUser);

                document.getElementById("specialistName").textContent = name;
            }

            // Обновляем данные супервизора
            const supervisors = Storage.get(STORAGE_KEYS.SPECIALISTS) || [];
            const supervisorIndex = supervisors.findIndex(
                (s) => s.userId === currentUser.id
            );

            if (supervisorIndex !== -1) {
                supervisors[supervisorIndex].name = name;
                supervisors[supervisorIndex].specialty = specialty;
                supervisors[supervisorIndex].experience = experience;
                supervisors[supervisorIndex].education = education;
                supervisors[supervisorIndex].description = description;
                supervisors[supervisorIndex].price = price;

                Storage.set(STORAGE_KEYS.SPECIALISTS, supervisors);
            }

            setTimeout(() => {
                hideLoader();
                showNotification("Профиль успешно обновлен", "success");
            }, 500);
        }

        // Добавление психолога
        function addPsychologist() {
            showLoader();

            const firstName = document.getElementById("clientFirstName").value;
            const lastName = document.getElementById("clientLastName").value;
            const email = document.getElementById("clientEmail").value;
            const phone = document.getElementById("clientPhone").value;
            const birthdate = document.getElementById("clientBirthdate").value;
            const notes = document.getElementById("clientNotes").value;

            // Создаем нового пользователя (психолога)
            const users = Storage.get(STORAGE_KEYS.USERS) || [];
            const newUser = {
                id: Date.now(),
                name: `${firstName} ${lastName}`,
                email: email || `psychologist${Date.now()}@example.com`,
                password: "tempPassword", // В реальном приложении нужно генерировать временный пароль
                role: "client",
                phone: phone,
                birthdate: birthdate,
                photo: "",
                helpNeeded: "Не указано",
            };

            users.push(newUser);
            Storage.set(STORAGE_KEYS.USERS, users);

            // Добавляем психолога в список психологов супервизора
            const psychologists = Storage.get(STORAGE_KEYS.CLIENTS) || [];
            psychologists.push({
                id: newUser.id,
                specialistId: currentUser.id,
                notes: notes,
            });

            Storage.set(STORAGE_KEYS.CLIENTS, psychologists);

            setTimeout(() => {
                hideLoader();
                document.getElementById("addClientForm").reset();
                showNotification("Психолог успешно добавлен", "success");

                // Обновляем список психологов
                loadSupervisorPsychologists();
                renderPsychologists();
            }, 500);
        }

        // Выход из системы
        function logout() {
            showLoader();

            setTimeout(() => {
                hideLoader();

                // Удаляем текущего пользователя
                currentUser = null;
                Storage.remove(STORAGE_KEYS.CURRENT_USER);

                // Скрыть личные кабинеты
                document.getElementById("clientDashboard").style.display = "none";
                document.getElementById("specialistDashboard").style.display = "none";

                // Показать основное содержимое
                document.getElementById("main-content").style.display = "flex";
                document.querySelector(".features").style.display = "block";
                document.querySelector(".help").style.display = "block";
                document.querySelector(".footer").style.display = "block";

                // Обновляем navbar: показываем menu и auth, скрываем logout
                document.querySelector(".nav-auth").style.display = "flex";
                document.querySelector(".nav-logout").style.display = "none";
                document.querySelectorAll(".mobile-menu .nav-item").forEach(item => item.style.display = "block");

                showNotification("Вы вышли из системы", "info");
            }, 500);
        }

        // Переключение вкладок в кабинете психолога
        function switchPsychologistTab(tabId) {
            // Деактивировать все кнопки
            document
                .querySelectorAll("#clientDashboard .tab-btn")
                .forEach((btn) => {
                    btn.classList.remove("active");
                });

            // Скрыть все вкладки
            document
                .querySelectorAll("#clientDashboard .tab-content")
                .forEach((tab) => {
                    tab.classList.remove("active");
                });

            // Активировать выбранную кнопку
            const activeBtn = document.querySelector(
                `#clientDashboard .tab-btn[data-tab="${tabId}"]`
            );
            if (activeBtn) activeBtn.classList.add("active");

            // Показать выбранную вкладку
            document.getElementById(`${tabId}Tab`).classList.add("active");

            if (tabId === "journal") {
                loadUserJournal();
                renderJournal();
            } else if (tabId === "appointments") {
                loadUserAppointments();
                renderAppointments();
                checkForNewAppointmentsPsychologist();
            } else if (tabId === "search") {
                renderSupervisors();
            }
        }

        // Переключение вкладок в кабинете супервизора
        function switchSupervisorTab(tabId) {
            // Деактивировать все кнопки
            document
                .querySelectorAll("#specialistDashboard .tab-btn")
                .forEach((btn) => {
                    btn.classList.remove("active");
                });

            // Скрыть все вкладки
            document
                .querySelectorAll("#specialistDashboard .tab-content")
                .forEach((tab) => {
                    tab.classList.remove("active");
                });

            // Активировать выбранную кнопку
            const activeBtn = document.querySelector(
                `#specialistDashboard .tab-btn[data-tab="${tabId}"]`
            );
            if (activeBtn) activeBtn.classList.add("active");

            // Показать выбранную вкладку
            document.getElementById(`${tabId}Tab`).classList.add("active");

            if (tabId === "schedule") {
                renderCalendar();
            } else if (tabId === "clients") {
                loadSupervisorPsychologists();
                renderPsychologists();
            } else if (tabId === "allAppointments") {
                renderAllAppointments();
                checkForNewAppointmentsSupervisor();
            }
        }

        // Инициализация раздела с супервизорами
        function initSupervisors() {
            renderSupervisors();

            // Применение фильтров
            document
                .getElementById("applyFilters")
                .addEventListener("click", function () {
                    renderSupervisors();
                });

            // Обработка клика по супервизору - открываем профиль
            document
                .getElementById("specialistsContainer")
                .addEventListener("click", function (e) {
                    if (e.target.classList.contains("btn-register")) {
                        const card = e.target.closest(".specialist-card");
                        const supervisorId = card.getAttribute("data-id");
                        openSupervisorFullProfileModal(supervisorId);
                    }
                });
        }

        // Открытие полного профиля супервизора в кабинете психолога
        function openSupervisorFullProfileModal(supervisorId) {
            const supervisor = supervisorsData.find(s => s.id == supervisorId);
            if (!supervisor) return;

            document.getElementById("specialistDetailTitle").textContent = `Профиль: ${supervisor.name}`;
            const content = document.getElementById("specialistFullProfileContent");
            content.innerHTML = `
          <div class="profile-section">
            <h4><i class="fas fa-user"></i> Основная информация</h4>
            <img src="${supervisor.avatar || supervisor.photo || 'https://randomuser.me/api/portraits/default.jpg'}" alt="${supervisor.name}" style="width: 150px; height: 150px; border-radius: 50%; object-fit: cover; margin: 1rem 0;">
            <p><strong>Имя и фамилия:</strong> ${supervisor.name}</p>
            <p><strong>Специализация:</strong> ${supervisor.specialty || "Не указана"}</p>
            <p><strong>Опыт работы (лет):</strong> ${supervisor.experience || 0}</p>
            <p><strong>Рейтинг:</strong> ${supervisor.rating || 0} (${supervisor.reviews || 0} отзывов)</p>
          </div>
          <div class="profile-section">
            <h4><i class="fas fa-book"></i> Образование</h4>
            <p>${supervisor.education || "Не указано"}</p>
          </div>
          <div class="profile-section">
            <h4><i class="fas fa-info-circle"></i> О себе</h4>
            <p>${supervisor.description || "Не указано"}</p>
          </div>
          <div class="profile-section">
            <h4><i class="fas fa-ruble-sign"></i> Цена за сессию</h4>
            <p><strong>${supervisor.price || 0} руб.</strong></p>
          </div>
          ${supervisor.video ? `
          <div class="profile-section video-section">
            <h4><i class="fas fa-video"></i> Видео профиля</h4>
            <video src="${supervisor.video}" class="video-preview" controls></video>
          </div>
          ` : ''}
          <div class="client-actions" style="margin-top: 2rem; text-align: center;">
            <button class="btn btn-register" onclick="handleSupervisorBooking(${supervisorId})" style="width: 100%; max-width: 300px;">Записаться на супервизию</button>
          </div>
        `;
            openModal("specialistDetailModal");
        }

        // Обработка записи из профиля супервизора
        function handleSupervisorBooking(supervisorId) {
            closeModal("specialistDetailModal");
            openPsychologistBookingModal(supervisorId);
        }

        // Отображение супервизоров
        function renderSupervisors() {
            const container = document.getElementById("specialistsContainer");
            container.innerHTML = "";

            const specialtyFilter =
                document.getElementById("specialtyFilter").value;
            const priceFilter = document.getElementById("priceFilter").value;
            const ratingFilter = document.getElementById("ratingFilter").value;
            const searchQuery = document
                .getElementById("searchInput")
                .value.toLowerCase();

            const filteredSupervisors = supervisorsData.filter((supervisor) => {
                // Фильтр по специализации
                if (specialtyFilter && supervisor.specialty !== specialtyFilter) {
                    return false;
                }

                // Фильтр по цене
                if (priceFilter) {
                    const priceRange = priceFilter.split("-");
                    const min = parseInt(priceRange[0]) || 0;

                    if (priceRange[1]) {
                        const max = parseInt(priceRange[1]) || Infinity;
                        if (supervisor.price < min || supervisor.price > max) {
                            return false;
                        }
                    } else if (supervisor.price < min) {
                        return false;
                    }
                }

                // Фильтр по рейтингу
                if (ratingFilter) {
                    const minRating = parseFloat(ratingFilter);
                    if (supervisor.rating < minRating) {
                        return false;
                    }
                }

                // Поиск по имени
                if (
                    searchQuery &&
                    !supervisor.name.toLowerCase().includes(searchQuery)
                ) {
                    return false;
                }

                return true;
            });

            if (filteredSupervisors.length === 0) {
                container.innerHTML =
                    '<p class="no-results">Супервизоры не найдены. Попробуйте изменить параметры фильтрации.</p>';
                return;
            }

            filteredSupervisors.forEach((supervisor) => {
                const card = document.createElement("div");
                card.className = "specialist-card";
                card.setAttribute("data-id", supervisor.id);

                card.innerHTML = `
                    <div class="specialist-header">
                        <img src="${supervisor.avatar || supervisor.photo || 'https://randomuser.me/api/portraits/default.jpg'}" alt="${supervisor.name
                    }" class="specialist-avatar">
                        <h3 class="specialist-name">${supervisor.name}</h3>
                        <p class="specialist-specialty">${supervisor.specialty
                    }</p>
                    </div>
                    <div class="specialist-body">
                        <div class="specialist-info">
                            <div class="specialist-rating">
                                <span class="rating-stars">${getRatingStars(
                        supervisor.rating
                    )}</span>
                                <span>${supervisor.rating} (${supervisor.reviews
                    } отзывов)</span>
                            </div>
                            <p>Опыт работы: ${supervisor.experience} лет</p>
                            <p class="specialist-price">${supervisor.price
                    } руб. / сессия</p>
                        </div>
                        <p>${supervisor.description}</p>
                    </div>
                    <div class="specialist-footer">
                        <button class="btn btn-register" style="width: 100%">Записаться на супервизию</button>
                    </div>
                `;

                container.appendChild(card);
            });
        }

        // Получение HTML для звезд рейтинга
        function getRatingStars(rating) {
            let stars = "";
            const fullStars = Math.floor(rating);
            const hasHalfStar = rating % 1 >= 0.5;

            for (let i = 0; i < fullStars; i++) {
                stars += '<i class="fas fa-star"></i>';
            }

            if (hasHalfStar) {
                stars += '<i class="fas fa-star-half-alt"></i>';
            }

            const emptyStars = 5 - fullStars - (hasHalfStar ? 1 : 0);
            for (let i = 0; i < emptyStars; i++) {
                stars += '<i class="far fa-star"></i>';
            }

            return stars;
        }

        // Инициализация системы бронирования
        function initBooking() {
            // Обработка формы бронирования
            document
                .getElementById("bookingForm")
                .addEventListener("submit", function (e) {
                    e.preventDefault();
                    confirmBooking();
                });
        }

        // Подтверждение бронирования
        function confirmBooking() {
            showLoader();

            const summaryElement = document.getElementById("bookingSummary");
            const appId = summaryElement.getAttribute("data-app-id");
            const supervisorId = summaryElement.getAttribute("data-specialist-id");
            const day = summaryElement.getAttribute("data-day");
            const time = summaryElement.getAttribute("data-time");
            const month = summaryElement.getAttribute("data-month");
            const year = summaryElement.getAttribute("data-year");
            const notes = document.getElementById("bookingNotes").value;

            const supervisor = supervisorsData.find((s) => s.id == supervisorId);
            if (!supervisor) return;

            if (appId) {
                // Обновление существующей сессии (перенос)
                const index = appointmentsData.findIndex(a => a.id == appId);
                if (index !== -1) {
                    appointmentsData[index].dateDay = parseInt(day);
                    appointmentsData[index].dateMonth = parseInt(month);
                    appointmentsData[index].dateYear = parseInt(year);
                    appointmentsData[index].time = time;
                    appointmentsData[index].notes = notes;
                    appointmentsData[index].status = "pending"; // Ожидает подтверждения после переноса

                    Storage.set(STORAGE_KEYS.APPOINTMENTS, appointmentsData);
                    updateBookingsFromAppointments();

                    closeModal("bookingModal");
                    showNotification("Перенос сессии отправлен! Ожидайте подтверждения от супервизора.", "success");
                    renderAppointments();
                }
            } else {
                // Создание новой сессии
                const newAppointment = {
                    id: Date.now(),
                    type: "client",
                    clientId: currentUser.id,
                    clientName: currentUser.name,
                    specialistId: supervisorId,
                    specialistName: supervisor.name,
                    dateDay: parseInt(day),
                    dateMonth: parseInt(month),
                    dateYear: parseInt(year),
                    time: time,
                    status: "pending",
                    creatorRole: "client",
                    notes: notes,
                    createdAt: new Date().toISOString(),
                    seenBySpecialist: false,
                };

                // Сохраняем сессию
                const appointments = Storage.get(STORAGE_KEYS.APPOINTMENTS) || [];
                appointments.push(newAppointment);
                Storage.set(STORAGE_KEYS.APPOINTMENTS, appointments);

                // Обновляем данные
                appointmentsData = Storage.get(STORAGE_KEYS.APPOINTMENTS) || []; // Reload global
                updateBookingsFromAppointments();

                closeModal("bookingModal");
                showNotification(
                    "Запрос на сессию отправлен! Ожидайте подтверждения от супервизора.",
                    "success"
                );

                // Обновляем календарь
                renderCalendar();
                renderTimeSlots(day);

                // Уведомляем супервизора (симуляция, в реальности - push или email)
                setTimeout(() => {
                    showNotification("Супервизор уведомлен о вашем запросе", "info");
                }, 1000);
            }

            hideLoader();
        }

        // Получение названия месяца
        function getMonthName(monthIndex) {
            const months = [
                "января",
                "февраля",
                "марта",
                "апреля",
                "мая",
                "июня",
                "июля",
                "августа",
                "сентября",
                "октября",
                "ноября",
                "декабря",
            ];
            return months[monthIndex];
        }

        // Инициализация календаря
        function initCalendar() {
            document
                .getElementById("prevMonth")
                .addEventListener("click", function () {
                    currentMonth--;
                    if (currentMonth < 0) {
                        currentMonth = 11;
                        currentYear--;
                    }
                    renderCalendar();
                });

            document
                .getElementById("nextMonth")
                .addEventListener("click", function () {
                    currentMonth++;
                    if (currentMonth > 11) {
                        currentMonth = 0;
                        currentYear++;
                    }
                    renderCalendar();
                });

            // Выбор дня
            document
                .getElementById("calendarDays")
                .addEventListener("click", function (e) {
                    if (e.target.classList.contains("calendar-day") &&
                        !e.target.classList.contains("disabled")) {
                        document
                            .querySelectorAll(".calendar-day")
                            .forEach((day) => day.classList.remove("selected"));
                        e.target.classList.add("selected");
                        renderTimeSlots(e.target.textContent);
                    }
                });

            // Выбор слота
            document
                .getElementById("timeSlotsContainer")
                .addEventListener("click", function (e) {
                    if (
                        e.target.classList.contains("time-slot")
                    ) {
                        if (e.target.classList.contains("booked")) {
                            // Переключаемся на вкладку со всеми сессиями
                            switchSupervisorTab("allAppointments");
                        } else {
                            document
                                .querySelectorAll(".time-slot")
                                .forEach((slot) => slot.classList.remove("selected"));
                            e.target.classList.add("selected");

                            // Получаем день
                            const selectedDayElement = document.querySelector(".calendar-day.selected");
                            if (selectedDayElement) {
                                const day = selectedDayElement.textContent;
                                const time = e.target.textContent;
                                openScheduleChoiceModal(day, time);
                            }
                        }
                    }
                });

            // Сохранение расписания
            document
                .getElementById("saveSchedule")
                .addEventListener("click", function () {
                    showLoader();

                    setTimeout(() => {
                        hideLoader();
                        showNotification("Расписание успешно сохранено", "success");
                    }, 500);
                });

            renderCalendar();
        }

        function openScheduleChoiceModal(day, time) {
            document.getElementById("scheduleChoiceModal").setAttribute("data-day", day);
            document.getElementById("scheduleChoiceModal").setAttribute("data-time", time);
            openModal("scheduleChoiceModal");
        }

        // Отображение календаря
        function renderCalendar() {
            const calendarDays = document.getElementById("calendarDays");
            calendarDays.innerHTML = "";

            const monthNames = [
                "Январь",
                "Февраль",
                "Март",
                "Апрель",
                "Май",
                "Июнь",
                "Июль",
                "Август",
                "Сентябрь",
                "Октябрь",
                "Ноябрь",
                "Декабрь",
            ];
            document.getElementById(
                "calendarMonth"
            ).textContent = `${monthNames[currentMonth]} ${currentYear}`;

            // Заголовки дней недели
            const daysOfWeek = ["Пн", "Вт", "Ср", "Чт", "Пт", "Сб", "Вс"];
            daysOfWeek.forEach((day) => {
                const dayElement = document.createElement("div");
                dayElement.className = "calendar-day";
                dayElement.textContent = day;
                dayElement.style.fontWeight = "bold";
                calendarDays.appendChild(dayElement);
            });

            const firstDay = new Date(currentYear, currentMonth, 1).getDay();
            const adjustedFirstDay = firstDay === 0 ? 6 : firstDay - 1; // Корректировка для отображения понедельника первым
            const daysInMonth = new Date(
                currentYear,
                currentMonth + 1,
                0
            ).getDate();

            // Пустые ячейки для дней предыдущего месяца
            for (let i = 0; i < adjustedFirstDay; i++) {
                const emptyDay = document.createElement("div");
                emptyDay.className = "calendar-day disabled";
                calendarDays.appendChild(emptyDay);
            }

            const supervisor = supervisorsData.find(s => s.userId === currentUser.id);
            const supervisorId = supervisor ? supervisor.id : null;

            // Дни текущего месяца
            for (let i = 1; i <= daysInMonth; i++) {
                const dayElement = document.createElement("div");
                dayElement.className = "calendar-day";
                dayElement.textContent = i;

                // Проверяем, есть ли бронирования на этот день
                const dateKey = `${currentYear}-${currentMonth + 1}-${i}`;
                if (supervisorId && bookings[supervisorId] && bookings[supervisorId][dateKey]) {
                    dayElement.classList.add("has-bookings");
                }

                // Проверяем, является ли день прошедшим
                const currentDate = new Date();
                const cellDate = new Date(currentYear, currentMonth, i);
                if (
                    cellDate < currentDate &&
                    cellDate.getDate() !== currentDate.getDate()
                ) {
                    dayElement.classList.add("disabled");
                }

                calendarDays.appendChild(dayElement);
            }

            renderTimeSlots();
        }

        // Отображение временных слотов
        function renderTimeSlots(selectedDay = null) {
            const timeSlotsContainer =
                document.getElementById("timeSlotsContainer");
            timeSlotsContainer.innerHTML = "";

            if (!selectedDay) {
                timeSlotsContainer.innerHTML =
                    "<p style='text-align: center; color: var(--text-light);'></p>";
                return;
            }

            const timeSlots = [
                "09:00",
                "10:00",
                "11:00",
                "12:00",
                "13:00",
                "14:00",
                "15:00",
                "16:00",
                "17:00",
                "18:00",
            ];

            const supervisor = supervisorsData.find(s => s.userId === currentUser.id);
            const supervisorId = supervisor ? supervisor.id : null;

            timeSlots.forEach((slot, index) => {
                const slotElement = document.createElement("div");
                slotElement.className = "time-slot";
                slotElement.textContent = slot;
                slotElement.style.animationDelay = `${index * 0.1}s`;

                const dateKey = `${currentYear}-${currentMonth + 1}-${selectedDay}`;
                if (supervisorId && bookings[supervisorId] && bookings[supervisorId][dateKey] && bookings[supervisorId][dateKey][slot]) {
                    slotElement.classList.add("booked");
                    slotElement.setAttribute("data-client", bookings[supervisorId][dateKey][slot]);
                }

                timeSlotsContainer.appendChild(slotElement);
            });
        }

        // Инициализация уведомлений
        function initNotifications() {
            // Код уже реализован в функциях showNotification, createNotification
        }

        // Показать уведомление
        function showNotification(message, type = "info") {
            const notification = createNotification(message, type);
            const container = document.getElementById("notificationContainer");

            container.appendChild(notification);

            // Показать уведомление
            setTimeout(() => {
                notification.classList.add("show");
            }, 100);

            // Скрыть уведомление через 5 секунд
            setTimeout(() => {
                notification.classList.remove("show");
                notification.classList.add("hide");

                // Удалить уведомление из DOM после анимации
                setTimeout(() => {
                    if (notification.parentNode) {
                        container.removeChild(notification);
                    }
                }, 300);
            }, 5000);
        }

        // Создание элемента уведомления
        function createNotification(message, type) {
            const notification = document.createElement("div");
            notification.className = `notification ${type}`;

            let icon = "info-circle";
            if (type === "success") icon = "check-circle";
            if (type === "error") icon = "exclamation-circle";

            notification.innerHTML = `
                <i class="fas fa-${icon} notification-icon"></i>
                <div class="notification-message">${message}</div>
            `;

            return notification;
        }

        // Показать индикатор загрузки
        function showLoader() {
            document.getElementById("loaderOverlay").classList.add("active");
        }

        // Скрыть индикатор загрузки
        function hideLoader() {
            document.getElementById("loaderOverlay").classList.remove("active");
        }

        // Инициализация дашборда
        function initDashboard() {
            // Код уже реализован
            // Загрузка данных психологов для супервизора
            renderPsychologists();

            // Загрузка сессий для психолога
            renderAppointments();

            // Обработчик для клика по карточке психолога (открытие модала полного профиля)
            document.getElementById("clientsContainer").addEventListener("click", function (e) {
                if (e.target.closest(".client-card")) {
                    const psychologistId = e.target.closest(".client-card").getAttribute("data-client-id");
                    openPsychologistFullProfileModal(psychologistId);
                }
            });

            // Обработка клика по кнопкам в сессиях психолога
            document.getElementById("appointmentsContainer").addEventListener("click", function (e) {
                if (e.target.classList.contains("cancel-btn")) {
                    const appId = e.target.getAttribute("data-app-id");
                    cancelAppointment(appId);
                } else if (e.target.classList.contains("reschedule-btn")) {
                    const appId = e.target.getAttribute("data-app-id");
                    rescheduleAppointment(appId);
                } else if (e.target.classList.contains("notes-btn")) {
                    const appId = e.target.getAttribute("data-app-id");
                    currentAppIdForNote = appId;
                    openModal("appointmentNotesChoiceModal");
                } else if (e.target.classList.contains("confirm-btn")) {
                    const appId = e.target.getAttribute("data-app-id");
                    handleAppointmentAction(appId, 'confirm');
                } else if (e.target.classList.contains("decline-btn")) {
                    const appId = e.target.getAttribute("data-app-id");
                    handleAppointmentAction(appId, 'decline');
                }
            });

            // Обработка клика по кнопкам в сессиях супервизора
            document.getElementById("allAppointmentsContainer").addEventListener("click", function (e) {
                if (e.target.tagName === "BUTTON") {
                    const appId = e.target.getAttribute("data-app-id");
                    const appIndex = appointmentsData.findIndex(a => a.id == appId);
                    if (appIndex !== -1) {
                        if (e.target.textContent === "Подтвердить") {
                            handleAppointmentAction(appId, 'confirm');
                        } else if (e.target.textContent === "Отклонить") {
                            handleAppointmentAction(appId, 'decline');
                        } else if (e.target.textContent === "Отменить") {
                            if (appointmentsData[appIndex].status === "pending") {
                                handleAppointmentAction(appId, 'decline');
                            } else {
                                cancelAppointment(appId);
                            }
                        } else if (e.target.textContent === "Сессия проведена") {
                            completeAppointment(appId);
                        } else if (e.target.textContent === "Перенести") {
                            openRescheduleModal(appId);
                        }
                        Storage.set(STORAGE_KEYS.APPOINTMENTS, appointmentsData);
                        updateBookingsFromAppointments();
                        renderAllAppointments();
                        renderCalendar(); // Обновляем календарь после отмены
                    }
                }
            });
        }

        // Открытие полного профиля психолога в модале
        function openPsychologistFullProfileModal(psychologistId) {
            const psychologist = psychologistsData.find(c => c.id == psychologistId);
            if (!psychologist) return;

            document.getElementById("clientDetailTitle").textContent = `Профиль: ${psychologist.name}`;
            const content = document.getElementById("clientFullProfileContent");
            content.innerHTML = `
          <div class="client-info-grid">
            <div class="profile-section">
              <h4><i class="fas fa-user"></i> Основная информация</h4>
              <img src="${psychologist.photo || 'https://randomuser.me/api/portraits/default.jpg'}" alt="${psychologist.name}" style="width: 150px; height: 150px; border-radius: 50%; object-fit: cover; margin: 1rem 0;">
              <p><strong>Имя:</strong> ${psychologist.name}</p>
              <p><strong>Email:</strong> ${psychologist.email}</p>
              <p><strong>Телефон:</strong> ${psychologist.phone || "Не указан"}</p>
              <p><strong>Дата рождения:</strong> ${psychologist.birthdate || "Не указана"}</p>
            </div>
            <div class="profile-section">
              <h4><i class="fas fa-exclamation-triangle"></i> Проблема / Запрос</h4>
              <p class="client-problem"><strong>Нужная помощь:</strong> ${psychologist.helpNeeded || "Не указано"}</p>
            </div>
            <div class="profile-section">
              <h4><i class="fas fa-calendar-check"></i> Следующая сессия</h4>
              <p><strong>Дата и время:</strong> ${psychologist.nextSession}</p>
            </div>
          </div>
          <div class="profile-section notes-section">
            <h4><i class="fas fa-notes-medical"></i> Заметки (${psychologist.notes.length})</h4>
            ${psychologist.notes.length > 0 ? psychologist.notes.map(note => `
              <div class="note-entry">
                <div class="note-date">${note.date}</div>
                <div class="note-content">${note.content}</div>
                <p><strong>Проблема на сессии:</strong> ${note.problemCameWith || "Не указано"}</p>
                <p><strong>Выявленный запрос:</strong> ${note.revealedRequest || "Не указано"}</p>
              </div>
            `).join("") : "<p>Заметок пока нет.</p>"}
          </div>
          <div class="client-actions">
            <button class="btn btn-register" onclick="openBookPsychologistModal(${psychologist.id})">Записать на сессию</button>
            <button class="btn btn-login" onclick="openNotesModal(${psychologist.id})">Добавить заметку</button>
          </div>
        `;
            openModal("clientDetailModal");
        }

        // Открытие оценки сессии
        function openRateSessionModal(appId) {
            document.getElementById("sessionAppId").value = appId;
            document.getElementById("sessionComment").value = "";
            document.getElementById("sessionProblem").value = "";
            document.getElementById("sessionConclusions").value = "";
            document.querySelectorAll(".emotion-btn").forEach(btn => btn.classList.remove("selected"));
            openModal("rateSessionModal");
        }

        // Обработка оценки
        function handleRateSession(e) {
            e.preventDefault();
            const appId = document.getElementById("sessionAppId").value;
            const comment = document.getElementById("sessionComment").value;
            const problem = document.getElementById("sessionProblem").value;
            const conclusions = document.getElementById("sessionConclusions").value;
            const emotions = Array.from(document.querySelectorAll(".emotion-btn.selected")).map(btn => btn.dataset.emotion);

            const appointment = appointmentsData.find(a => a.id == appId);
            if (!appointment || appointment.status !== "completed") return;

            const newJournalEntry = {
                id: Date.now(),
                userId: currentUser.id,
                date: `${appointment.dateDay} ${getMonthName(appointment.dateMonth - 1)} ${appointment.dateYear}`,
                content: `Оценка сессии с ${appointment.specialistName} (${appointment.time}): Проблема: ${problem || "Не указана"}. Выводы: ${conclusions || "Не указаны"}. Комментарий: ${comment}. Эмоции: ${emotions.join(", ") || "Не указаны"}`,
                createdAt: new Date().toISOString(),
            };

            const journals = Storage.get(STORAGE_KEYS.JOURNALS) || [];
            journals.push(newJournalEntry);
            Storage.set(STORAGE_KEYS.JOURNALS, journals);
            journalData = Storage.get(STORAGE_KEYS.JOURNALS) || []; // Reload global

            loadUserJournal();
            renderJournal();

            closeModal("rateSessionModal");
            showNotification("Оценка добавлена в дневник", "success");
        }

        // Отмена сессии психолога
        function cancelAppointment(appId) {
            const index = appointmentsData.findIndex(a => a.id == appId);
            if (index !== -1) {
                appointmentsData[index].status = "cancelled";
                Storage.set(STORAGE_KEYS.APPOINTMENTS, appointmentsData);
                updateBookingsFromAppointments();
                loadUserAppointments();
                renderAppointments();
                showNotification("Сессия отменена", "success");
            }
        }

        // Завершение сессии
        function completeAppointment(appId) {
            const index = appointmentsData.findIndex(a => a.id == appId);
            if (index !== -1) {
                appointmentsData[index].status = "completed";
                Storage.set(STORAGE_KEYS.APPOINTMENTS, appointmentsData);
                updateBookingsFromAppointments();
                renderAllAppointments();
                showNotification("Сессия отмечена как проведенная", "success");
            }
        }

        // Перенос сессии психолога
        function rescheduleAppointment(appId) {
            const appointment = appointmentsData.find(a => a.id == appId);
            if (appointment) {
                if (currentUser.role === "client") {
                    document.getElementById("clientBookingModal").setAttribute("data-app-id", appId);
                    openPsychologistBookingModal(appointment.specialistId);
                } else {
                    openRescheduleModal(appId);
                }
            }
        }

        // Отображение психологов
        function renderPsychologists() {
            const container = document.getElementById("clientsContainer");
            container.innerHTML = "";

            if (psychologistsData.length === 0) {
                container.innerHTML = "<p>У вас пока нет психологов.</p>";
                return;
            }

            psychologistsData.forEach((psychologist) => {
                const card = document.createElement("div");
                card.className = "client-card";
                card.setAttribute("data-client-id", psychologist.id);

                card.innerHTML = `
                    <div class="client-header">
                        <img src="${psychologist.photo || 'https://randomuser.me/api/portraits/default.jpg'}" alt="${psychologist.name
                    }" class="client-avatar">
                        <div>
                            <h3 class="client-name">${psychologist.name}</h3>
                            <p class="client-next-session">Следующая сессия: ${psychologist.nextSession
                    }</p>
                            <p><strong>Проблема:</strong> ${psychologist.helpNeeded || "Не указано"
                    }</p>
                        </div>
                    </div>
                    <p><strong>Телефон:</strong> ${psychologist.phone || "Не указан"
                    }</p>
                    <p><strong>Email:</strong> ${psychologist.email}</p>
                    <div class="client-actions">
                      <button class="btn btn-register" onclick="openBookPsychologistModal(${psychologist.id})">Записать</button>
                      <button class="btn btn-login" onclick="openNotesModal(${psychologist.id})">Заметки</button>
                    </div>
                `;

                container.appendChild(card);
            });
        }

        // Отображение сессий психолога (с сортировкой по дате)
        function renderAppointments() {
            const container = document.getElementById("appointmentsContainer");
            container.innerHTML = "";

            const userAppointments = appointmentsData.filter(
                (a) => a.clientId === currentUser.id && a.type === "client"
            ).sort((a, b) => {
                const dateA = new Date(a.dateYear, a.dateMonth - 1, a.dateDay, parseInt(a.time.split(':')[0]), parseInt(a.time.split(':')[1]));
                const dateB = new Date(b.dateYear, b.dateMonth - 1, b.dateDay, parseInt(b.time.split(':')[0]), parseInt(b.time.split(':')[1]));
                return dateA - dateB;
            });

            if (userAppointments.length === 0) {
                container.innerHTML =
                    "<p>У вас пока нет сессий супервизии.</p>";
                return;
            }

            userAppointments.forEach((appointment) => {
                if (appointment.status === "cancelled" || appointment.status === "completed") return; // Не показываем отмененные и проведенные

                const appointmentElement = document.createElement("div");
                appointmentElement.className = `help-card ${appointment.status === "pending" ? "pending-appointment-card" : ""}`;

                let statusText = "";
                let actions = "";
                if (appointment.status === "pending") {
                    if (appointment.creatorRole === "specialist") {
                        // Сессия от супервизора, психолог подтверждает
                        statusText = '<span style="color: #f39c12;">Предложена супервизором</span>';
                        actions = `
                <div class="client-actions">
                  <button class="btn btn-register confirm-btn" data-app-id="${appointment.id}">Подтвердить</button>
                  <button class="btn btn-login decline-btn" data-app-id="${appointment.id}">Отклонить</button>
                </div>
              `;
                    } else {
                        // Сессия от психолога, ждет супервизора
                        statusText = '<span style="color: #f39c12;">Ожидание подтверждения</span>';
                        actions = `
                <div class="client-actions">
                  <button class="btn btn-login reschedule-btn" data-app-id="${appointment.id}">Перенести</button>
                  <button class="btn btn-register cancel-btn" data-app-id="${appointment.id}">Отменить</button>
                </div>
              `;
                    }
                } else if (appointment.status === "confirmed") {
                    statusText = '<span style="color: var(--success);">Подтверждена</span>';
                    actions = `
              <div class="client-actions">
                <button class="btn btn-login reschedule-btn" data-app-id="${appointment.id}">Перенести</button>
                <button class="btn btn-info notes-btn" data-app-id="${appointment.id}">Заметки</button>
                <button class="btn btn-register cancel-btn" data-app-id="${appointment.id}">Отменить</button>
              </div>
            `;
                }

                appointmentElement.innerHTML = `
                    <h3 class="help-title"><i class="fas fa-calendar-check"></i> Сессия у ${appointment.specialistName
                    }</h3>
                    <p><strong>Дата и время:</strong> ${appointment.dateDay
                    } ${getMonthName(appointment.dateMonth - 1)} ${appointment.dateYear
                    }, ${appointment.time}</p>
                    <p><strong>Статус:</strong> ${statusText}</p>
                    ${actions}
                `;

                container.appendChild(appointmentElement);
            });
        }

        // Отображение всех сессий супервизора с сортировкой и группировкой по дням
        function renderAllAppointments() {
            const container = document.getElementById("allAppointmentsContainer");
            container.innerHTML = "";

            const mySupervisor = supervisorsData.find(s => s.userId === currentUser.id);
            if (!mySupervisor) {
                container.innerHTML = "<p>Ошибка: супервизор не найден.</p>";
                return;
            }

            let myAppointments = appointmentsData.filter(a => a.specialistId === mySupervisor.id).sort((a, b) => {
                const dateA = new Date(a.dateYear, a.dateMonth - 1, a.dateDay, parseInt(a.time.split(':')[0]), parseInt(a.time.split(':')[1]));
                const dateB = new Date(b.dateYear, b.dateMonth - 1, b.dateDay, parseInt(b.time.split(':')[0]), parseInt(b.time.split(':')[1]));
                return dateA - dateB;
            });

            if (myAppointments.length === 0) {
                container.innerHTML =
                    "<p>Сессий пока нет.</p>";
                return;
            }

            // Группировка по дням
            let currentDate = null;
            myAppointments.forEach(app => {
                const appDate = `${app.dateDay}.${app.dateMonth}.${app.dateYear}`;
                if (appDate !== currentDate) {
                    const dateHeader = document.createElement("h3");
                    dateHeader.textContent = appDate;
                    dateHeader.style.marginTop = "1rem";
                    container.appendChild(dateHeader);
                    currentDate = appDate;
                }

                const card = document.createElement("div");
                if (app.type === "plan") {
                    card.className = "client-card plan-card";

                    let statusText = "";
                    let actions = "";
                    if (app.status === "cancelled") {
                        statusText = '<span style="color: var(--error);">Отменено</span>';
                        actions = "";
                    } else if (app.status === "completed") {
                        statusText = '<span style="color: var(--success);">Проведено</span>';
                        actions = "";
                    } else {
                        statusText = '<span style="color: var(--success);">Запланировано</span>';
                        actions = `
                <div class="client-actions" style="margin-top: 1rem;">
                  <button class="btn btn-register cancel-btn" data-app-id="${app.id}">Отменить</button>
                </div>
              `;
                    }

                    card.innerHTML = `
              <h3><i class="fas fa-calendar-alt"></i> ${app.planTitle} - ${app.time}</h3>
              <p>Описание: ${app.planDescription}</p>
              <p>Статус: ${statusText}</p>
              ${actions}
            `;
                } else {
                    card.className = `client-card ${app.status === "pending" ? "pending-appointment-card" : ""}`;
                    let statusText = "";
                    let actions = "";
                    if (app.status === "confirmed") {
                        statusText = '<span style="color: var(--success);">Подтверждена</span>';
                        actions = `
                <div class="client-actions">
                  <button class="btn btn-login reschedule-btn" data-app-id="${app.id}">Перенести</button>
                  <button class="btn btn-register cancel-btn" data-app-id="${app.id}">Отменить</button>
                  <button class="btn btn-register complete-btn" data-app-id="${app.id}">Сессия проведена</button>
                </div>
              `;
                    } else if (app.status === "pending") {
                        if (app.creatorRole === "client") {
                            // Запрос от психолога
                            statusText = '<span style="color: #f39c12;">Новый запрос на сессию</span>';
                            actions = `
                  <div class="client-actions">
                    <button class="btn btn-register confirm-btn" data-app-id="${app.id}">Подтвердить</button>
                    <button class="btn btn-login decline-btn" data-app-id="${app.id}">Отклонить</button>
                  </div>
                `;
                        } else {
                            // Сессия от супервизора, ждет психолога
                            statusText = '<span style="color: #f39c12;">Ожидание подтверждения психолога</span>';
                            actions = `
                  <div class="client-actions">
                    <button class="btn btn-register cancel-btn" data-app-id="${app.id}">Отменить</button>
                  </div>
                `;
                        }
                    } else if (app.status === "completed") {
                        statusText = '<span style="color: var(--success);">Проведена</span>';
                        actions = "";
                    } else if (app.status === "cancelled") {
                        statusText = '<span style="color: var(--error);">Отменена</span>';
                    }

                    card.innerHTML = `
              <h3><i class="fas fa-user"></i> ${app.clientName} - ${app.time}</h3>
              <p>Статус: ${statusText}</p>
              <p>Заметки: ${app.notes || "Нет"}</p>
              ${actions}
            `;
                }

                container.appendChild(card);
            });
        }

        // Инициализация заметок
        function initNotes() {
            // Добавление заметки
            document
                .getElementById("notesForm")
                .addEventListener("submit", function (e) {
                    e.preventDefault();
                    const psychologistId = this.getAttribute("data-client-id");
                    const content = document.getElementById("noteContent").value;
                    const problem = document.querySelector(".problem-option.selected").dataset.problem;
                    const request = document.querySelector(".request-option.selected").dataset.request;

                    if (content.trim() === "") return;

                    // Создаем новую заметку
                    const newNote = {
                        id: Date.now(),
                        clientId: parseInt(psychologistId),
                        specialistId: currentUser.id,
                        date: new Date().toLocaleDateString("ru-RU"),
                        content,
                        problemCameWith: problem,
                        revealedRequest: request,
                        createdAt: new Date().toISOString(),
                    };

                    // Сохраняем заметку
                    const notes = Storage.get(STORAGE_KEYS.NOTES) || [];
                    notes.push(newNote);
                    Storage.set(STORAGE_KEYS.NOTES, notes);
                    notesData = Storage.get(STORAGE_KEYS.NOTES) || []; // Reload global

                    document.getElementById("noteContent").value = "";
                    document
                        .querySelectorAll(".problem-option")
                        .forEach((el) => el.classList.remove("selected"));
                    document
                        .querySelectorAll(".request-option")
                        .forEach((el) => el.classList.remove("selected"));

                    renderNotes(psychologistId);
                    loadSupervisorPsychologists();
                    renderPsychologists();
                    showNotification("Заметка добавлена", "success");
                });
        }

        // Открытие модального окна заметок
        function openNotesModal(psychologistId) {
            const psychologist = psychologistsData.find((c) => c.id == psychologistId);
            if (psychologist) {
                document.getElementById(
                    "notesTitle"
                ).textContent = `Заметки для ${psychologist.name}`;
                document
                    .getElementById("notesForm")
                    .setAttribute("data-client-id", psychologistId);
                renderNotes(psychologistId);
                openModal("notesModal");
            }
        }

        // Отображение заметок
        function renderNotes(psychologistId) {
            const container = document.getElementById("notesList");
            container.innerHTML = "";

            const psychologistNotes = notesData.filter((n) => n.clientId == psychologistId);

            if (psychologistNotes.length === 0) {
                container.innerHTML = "<p>Заметок пока нет.</p>";
                return;
            }

            psychologistNotes.forEach((note, index) => {
                const entry = document.createElement("div");
                entry.className = "note-entry";
                entry.style.animationDelay = `${index * 0.1}s`;

                entry.innerHTML = `
                    <div class="note-date">${note.date}</div>
                    <div class="note-content">${note.content}</div>
                    <p><strong>Проблема:</strong> ${note.problemCameWith || "Не указано"}</p>
                    <p><strong>Запрос:</strong> ${note.revealedRequest || "Не указано"}</p>
                `;

                container.appendChild(entry);
            });
        }

        // Инициализация дневника психолога
        function initJournal() {
            document
                .getElementById("journalForm")
                .addEventListener("submit", function (e) {
                    e.preventDefault();
                    const content = document.getElementById("journalContent").value;

                    if (content.trim() === "") return;

                    // Создаем новую запись в дневнике
                    const newJournalEntry = {
                        id: Date.now(),
                        userId: currentUser.id,
                        date: new Date().toLocaleDateString("ru-RU"),
                        content,
                        createdAt: new Date().toISOString(),
                    };

                    // Сохраняем запись
                    const journals = Storage.get(STORAGE_KEYS.JOURNALS) || [];
                    journals.push(newJournalEntry);
                    Storage.set(STORAGE_KEYS.JOURNALS, journals);
                    journalData = Storage.get(STORAGE_KEYS.JOURNALS) || []; // Reload global

                    document.getElementById("journalContent").value = "";
                    loadUserJournal();
                    renderJournal();
                    showNotification("Запись добавлена в дневник", "success");
                });
        }

        // Отображение дневника
        function renderJournal() {
            const container = document.getElementById("journalEntries");
            container.innerHTML = "";

            const userJournalEntries = journalData.filter((j) => j.userId === currentUser.id).sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));

            if (userJournalEntries.length === 0) {
                container.innerHTML = "<p>Записей пока нет.</p>";
                return;
            }

            userJournalEntries.forEach((entry, index) => {
                const journalEntry = document.createElement("div");
                journalEntry.className = "journal-entry animate";
                journalEntry.style.animationDelay = `${index * 0.1}s`;

                journalEntry.innerHTML = `
                    <div class="journal-date">${entry.date}</div>
                    <div class="journal-content">${entry.content}</div>
                `;

                container.appendChild(journalEntry);
            });
        }

        // Инициализация всех сессий супервизора
        function initSpecialistAppointments() {
            document.getElementById("allAppointmentsContainer").addEventListener("click", function (e) {
                if (e.target.tagName === "BUTTON") {
                    const appId = e.target.getAttribute("data-app-id");
                    const appIndex = appointmentsData.findIndex(a => a.id == appId);
                    if (appIndex !== -1) {
                        if (e.target.textContent === "Подтвердить") {
                            handleAppointmentAction(appId, 'confirm');
                        } else if (e.target.textContent === "Отклонить") {
                            handleAppointmentAction(appId, 'decline');
                        } else if (e.target.textContent === "Отменить") {
                            if (appointmentsData[appIndex].status === "pending") {
                                handleAppointmentAction(appId, 'decline');
                            } else {
                                cancelAppointment(appId);
                            }
                        } else if (e.target.textContent === "Сессия проведена") {
                            completeAppointment(appId);
                        } else if (e.target.textContent === "Перенести") {
                            openRescheduleModal(appId);
                        }
                        Storage.set(STORAGE_KEYS.APPOINTMENTS, appointmentsData);
                        updateBookingsFromAppointments();
                        renderAllAppointments();
                        renderCalendar(); // Обновляем календарь после отмены
                    }
                }
            });
        }

        // Инициализация выбора в расписании
        function initScheduleChoice() {
            document.getElementById("bookClientChoice").addEventListener("click", handleBookPsychologistChoice);
            document.getElementById("otherPlanChoice").addEventListener("click", handleOtherPlanChoice);
            document.getElementById("bookSpecificClientForm").addEventListener("submit", handleSpecificPsychologistBooking);
            document.getElementById("otherPlanForm").addEventListener("submit", handleAddPlan);
        }

        function handleBookPsychologistChoice() {
            const day = document.getElementById("scheduleChoiceModal").getAttribute("data-day");
            const time = document.getElementById("scheduleChoiceModal").getAttribute("data-time");
            closeModal("scheduleChoiceModal");

            // Populate select
            const select = document.getElementById("selectClient");
            select.innerHTML = "";
            psychologistsData.forEach((psychologist) => {
                const option = document.createElement("option");
                option.value = psychologist.id;
                option.textContent = psychologist.name;
                select.appendChild(option);
            });

            // Set slot info
            document.getElementById("selectedSlotInfo").innerHTML = `
          <div class="booking-detail">
            <strong>Дата:</strong> <span>${day} ${getMonthName(currentMonth)} ${currentYear}</span>
          </div>
          <div class="booking-detail">
            <strong>Время:</strong> <span>${time}</span>
          </div>
        `;

            // Set data
            document.getElementById("bookSpecificClientModal").setAttribute("data-day", day);
            document.getElementById("bookSpecificClientModal").setAttribute("data-time", time);

            openModal("bookSpecificClientModal");
        }

        function handleSpecificPsychologistBooking(e) {
            e.preventDefault();
            const psychologistId = parseInt(document.getElementById("selectClient").value);
            const day = parseInt(document.getElementById("bookSpecificClientModal").getAttribute("data-day"));
            const time = document.getElementById("bookSpecificClientModal").getAttribute("data-time");
            const psychologist = psychologistsData.find((c) => c.id === psychologistId);
            const supervisor = supervisorsData.find((s) => s.userId === currentUser.id);

            if (!psychologist || !supervisor) {
                showNotification("Ошибка: психолог или супервизор не найден", "error");
                return;
            }

            const newAppointment = {
                id: Date.now(),
                type: "client",
                clientId: psychologist.id,
                clientName: psychologist.name,
                specialistId: supervisor.id,
                specialistName: supervisor.name,
                dateDay: day,
                dateMonth: currentMonth + 1,
                dateYear: currentYear,
                time: time,
                status: "pending",
                creatorRole: "specialist",
                notes: "",
                createdAt: new Date().toISOString(),
                seenByClient: false,
            };

            const appointments = Storage.get(STORAGE_KEYS.APPOINTMENTS) || [];
            appointments.push(newAppointment);
            Storage.set(STORAGE_KEYS.APPOINTMENTS, appointments);
            appointmentsData = Storage.get(STORAGE_KEYS.APPOINTMENTS) || []; // Reload global

            updateBookingsFromAppointments();

            closeModal("bookSpecificClientModal");
            showNotification("Психолог записан на сессию (ожидает подтверждения)", "success");
            renderCalendar();
        }

        function handleOtherPlanChoice() {
            const day = document.getElementById("scheduleChoiceModal").getAttribute("data-day");
            const time = document.getElementById("scheduleChoiceModal").getAttribute("data-time");
            closeModal("scheduleChoiceModal");

            // Set slot info
            document.getElementById("selectedPlanSlotInfo").innerHTML = `
          <div class="booking-detail">
            <strong>Дата:</strong> <span>${day} ${getMonthName(currentMonth)} ${currentYear}</span>
          </div>
          <div class="booking-detail">
            <strong>Время:</strong> <span>${time}</span>
          </div>
        `;

            // Set data
            document.getElementById("otherPlanModal").setAttribute("data-day", day);
            document.getElementById("otherPlanModal").setAttribute("data-time", time);

            openModal("otherPlanModal");
        }

        function handleAddPlan(e) {
            e.preventDefault();
            const title = document.getElementById("planTitle").value.trim();
            const desc = document.getElementById("planDescription").value.trim();
            const day = parseInt(document.getElementById("otherPlanModal").getAttribute("data-day"));
            const time = document.getElementById("otherPlanModal").getAttribute("data-time");
            const supervisor = supervisorsData.find((s) => s.userId === currentUser.id);

            if (!title || !desc || !supervisor) {
                showNotification("Заполните все поля", "error");
                return;
            }

            const newAppointment = {
                id: Date.now(),
                type: "plan",
                planTitle: title,
                planDescription: desc,
                specialistId: supervisor.id,
                specialistName: supervisor.name,
                dateDay: day,
                dateMonth: currentMonth + 1,
                dateYear: currentYear,
                time: time,
                status: "confirmed",
                notes: "",
                createdAt: new Date().toISOString(),
            };

            const appointments = Storage.get(STORAGE_KEYS.APPOINTMENTS) || [];
            appointments.push(newAppointment);
            Storage.set(STORAGE_KEYS.APPOINTMENTS, appointments);
            appointmentsData = Storage.get(STORAGE_KEYS.APPOINTMENTS) || []; // Reload global

            updateBookingsFromAppointments();

            document.getElementById("otherPlanForm").reset();
            closeModal("otherPlanModal");
            showNotification("План добавлен", "success");
            renderCalendar();
        }

        // Инициализация записи психолога супервизором
        function initBookPsychologist() {
            let bookCurrentMonth = new Date().getMonth();
            let bookCurrentYear = new Date().getFullYear();

            function renderBookCalendar() {
                const calendarDays = document.getElementById("bookCalendarDays");
                calendarDays.innerHTML = "";

                const monthNames = [
                    "Январь",
                    "Февраль",
                    "Март",
                    "Апрель",
                    "Май",
                    "Июнь",
                    "Июль",
                    "Август",
                    "Сентябрь",
                    "Октябрь",
                    "Ноябрь",
                    "Декабрь",
                ];
                document.getElementById(
                    "bookCalendarMonth"
                ).textContent = `${monthNames[bookCurrentMonth]} ${bookCurrentYear}`;

                // Заголовки дней недели
                const daysOfWeek = ["Пн", "Вт", "Ср", "Чт", "Пт", "Сб", "Вс"];
                daysOfWeek.forEach((day) => {
                    const dayElement = document.createElement("div");
                    dayElement.className = "calendar-day";
                    dayElement.textContent = day;
                    dayElement.style.fontWeight = "bold";
                    calendarDays.appendChild(dayElement);
                });

                const firstDay = new Date(bookCurrentYear, bookCurrentMonth, 1).getDay();
                const adjustedFirstDay = firstDay === 0 ? 6 : firstDay - 1;
                const daysInMonth = new Date(
                    bookCurrentYear,
                    bookCurrentMonth + 1,
                    0
                ).getDate();

                for (let i = 0; i < adjustedFirstDay; i++) {
                    const emptyDay = document.createElement("div");
                    emptyDay.className = "calendar-day disabled";
                    calendarDays.appendChild(emptyDay);
                }

                const supervisor = supervisorsData.find(s => s.userId === currentUser.id);
                const supervisorId = supervisor ? supervisor.id : null;

                for (let i = 1; i <= daysInMonth; i++) {
                    const dayElement = document.createElement("div");
                    dayElement.className = "calendar-day";
                    dayElement.textContent = i;

                    const dateKey = `${bookCurrentYear}-${bookCurrentMonth + 1}-${i}`;
                    if (supervisorId && bookings[supervisorId] && bookings[supervisorId][dateKey]) {
                        dayElement.classList.add("has-bookings");
                    }

                    const currentDate = new Date();
                    const cellDate = new Date(bookCurrentYear, bookCurrentMonth, i);
                    if (
                        cellDate < currentDate &&
                        cellDate.getDate() !== currentDate.getDate()
                    ) {
                        dayElement.classList.add("disabled");
                    }

                    calendarDays.appendChild(dayElement);
                }

                renderBookTimeSlots();
            }

            function renderBookTimeSlots(selectedDay = null) {
                const timeSlotsContainer = document.getElementById("bookTimeSlotsContainer");
                timeSlotsContainer.innerHTML = "";

                if (!selectedDay) {
                    timeSlotsContainer.innerHTML = "<p></p>";
                    return;
                }

                const timeSlots = [
                    "09:00", "10:00", "11:00", "12:00", "13:00",
                    "14:00", "15:00", "16:00", "17:00", "18:00",
                ];

                const supervisor = supervisorsData.find(s => s.userId === currentUser.id);
                const supervisorId = supervisor ? supervisor.id : null;

                timeSlots.forEach((slot, index) => {
                    const slotElement = document.createElement("div");
                    slotElement.className = "time-slot";
                    slotElement.textContent = slot;
                    slotElement.style.animationDelay = `${index * 0.1}s`;

                    const dateKey = `${bookCurrentYear}-${bookCurrentMonth + 1}-${selectedDay}`;
                    if (supervisorId && bookings[supervisorId] && bookings[supervisorId][dateKey] && bookings[supervisorId][dateKey][slot]) {
                        slotElement.classList.add("booked");
                        slotElement.setAttribute("data-client", bookings[supervisorId][dateKey][slot]);
                    }

                    timeSlotsContainer.appendChild(slotElement);
                });
            }

            // Обработчики для модального календаря
            document.getElementById("bookPrevMonth").addEventListener("click", () => {
                bookCurrentMonth--;
                if (bookCurrentMonth < 0) {
                    bookCurrentMonth = 11;
                    bookCurrentYear--;
                }
                renderBookCalendar();
            });

            document.getElementById("bookNextMonth").addEventListener("click", () => {
                bookCurrentMonth++;
                if (bookCurrentMonth > 11) {
                    bookCurrentMonth = 0;
                    bookCurrentYear++;
                }
                renderBookCalendar();
            });

            document.getElementById("bookCalendarDays").addEventListener("click", (e) => {
                if (
                    e.target.classList.contains("calendar-day") &&
                    !e.target.classList.contains("disabled")
                ) {
                    document
                        .querySelectorAll("#bookCalendarDays .calendar-day")
                        .forEach((day) => day.classList.remove("selected"));
                    e.target.classList.add("selected");
                    renderBookTimeSlots(e.target.textContent);
                }
            });

            document.getElementById("bookTimeSlotsContainer").addEventListener("click", (e) => {
                if (
                    e.target.classList.contains("time-slot") &&
                    !e.target.classList.contains("booked")
                ) {
                    document
                        .querySelectorAll("#bookTimeSlotsContainer .time-slot")
                        .forEach((slot) => slot.classList.remove("selected"));
                    e.target.classList.add("selected");
                }
            });

            // Подтверждение записи
            document.getElementById("confirmBookClient").addEventListener("click", () => {
                const modal = document.getElementById("bookClientModal");
                const psychologistId = modal.getAttribute("data-client-id");
                const selectedDayElement = document.querySelector("#bookCalendarDays .calendar-day.selected");
                if (!selectedDayElement) {
                    showNotification("Выберите день", "error");
                    return;
                }
                const selectedDay = selectedDayElement.textContent;
                const selectedTimeElement = document.querySelector("#bookTimeSlotsContainer .time-slot.selected");
                if (!selectedTimeElement) {
                    showNotification("Выберите время", "error");
                    return;
                }
                const selectedTime = selectedTimeElement.textContent;

                const mySupervisor = supervisorsData.find(s => s.userId === currentUser.id);
                const psychologist = psychologistsData.find(c => c.id == psychologistId);

                if (!mySupervisor || !psychologist) return;

                const newAppointment = {
                    id: Date.now(),
                    type: "client",
                    clientId: psychologist.id,
                    clientName: psychologist.name,
                    specialistId: mySupervisor.id,
                    specialistName: mySupervisor.name,
                    dateDay: parseInt(selectedDay),
                    dateMonth: bookCurrentMonth + 1,
                    dateYear: bookCurrentYear,
                    time: selectedTime,
                    status: "pending",
                    creatorRole: "specialist",
                    notes: "",
                    createdAt: new Date().toISOString(),
                    seenByClient: false,
                };

                const appointments = Storage.get(STORAGE_KEYS.APPOINTMENTS) || [];
                appointments.push(newAppointment);
                Storage.set(STORAGE_KEYS.APPOINTMENTS, appointments);
                appointmentsData = Storage.get(STORAGE_KEYS.APPOINTMENTS) || []; // Reload global

                updateBookingsFromAppointments();

                // Close modal
                closeModal("bookClientModal");
                showNotification("Предложение о сессии отправлено психологу (ожидает подтверждения)", "success");

                // Уведомляем психолога
                setTimeout(() => showNotification("Психолог уведомлен о предложении сессии", "info"), 1000);

                // Refresh views
                renderAllAppointments();
                loadSupervisorPsychologists();
                renderPsychologists();
            });
        }

        // Открытие модального окна записи психолога
        function openBookPsychologistModal(psychologistId) {
            document.getElementById("bookClientModal").setAttribute("data-client-id", psychologistId);

            // Reset selections
            document.querySelectorAll("#bookCalendarDays .calendar-day").forEach(day => day.classList.remove("selected"));
            document.querySelectorAll("#bookTimeSlotsContainer .time-slot").forEach(slot => slot.classList.remove("selected"));

            openModal("bookClientModal");
            renderBookCalendar();
        }

        // Открытие психологовского модального окна бронирования
        function openPsychologistBookingModal(supervisorId) {
            document.getElementById("clientBookingModal").setAttribute("data-specialist-id", supervisorId);

            // Reset selections
            document.querySelectorAll("#clientCalendarDays .calendar-day").forEach(day => day.classList.remove("selected"));
            document.querySelectorAll("#clientTimeSlotsContainer .time-slot").forEach(slot => slot.classList.remove("selected"));

            openModal("clientBookingModal");
            renderPsychologistCalendar(supervisorId);
        }

        // Инициализация психологовского модального календаря
        function initPsychologistBookingModal() {
            let psychologistCurrentMonth = new Date().getMonth();
            let psychologistCurrentYear = new Date().getFullYear();

            function renderPsychologistCalendar(supervisorId) {
                const calendarDays = document.getElementById("clientCalendarDays");
                calendarDays.innerHTML = "";

                const monthNames = [
                    "Январь",
                    "Февраль",
                    "Март",
                    "Апрель",
                    "Май",
                    "Июнь",
                    "Июль",
                    "Август",
                    "Сентябрь",
                    "Октябрь",
                    "Ноябрь",
                    "Декабрь",
                ];
                document.getElementById(
                    "clientCalendarMonth"
                ).textContent = `${monthNames[psychologistCurrentMonth]} ${psychologistCurrentYear}`;

                // Заголовки дней недели
                const daysOfWeek = ["Пн", "Вт", "Ср", "Чт", "Пт", "Сб", "Вс"];
                daysOfWeek.forEach((day) => {
                    const dayElement = document.createElement("div");
                    dayElement.className = "calendar-day";
                    dayElement.textContent = day;
                    dayElement.style.fontWeight = "bold";
                    calendarDays.appendChild(dayElement);
                });

                const firstDay = new Date(psychologistCurrentYear, psychologistCurrentMonth, 1).getDay();
                const adjustedFirstDay = firstDay === 0 ? 6 : firstDay - 1;
                const daysInMonth = new Date(
                    psychologistCurrentYear,
                    psychologistCurrentMonth + 1,
                    0
                ).getDate();

                for (let i = 0; i < adjustedFirstDay; i++) {
                    const emptyDay = document.createElement("div");
                    emptyDay.className = "calendar-day disabled";
                    calendarDays.appendChild(emptyDay);
                }

                for (let i = 1; i <= daysInMonth; i++) {
                    const dayElement = document.createElement("div");
                    dayElement.className = "calendar-day";
                    dayElement.textContent = i;

                    const dateKey = `${psychologistCurrentYear}-${psychologistCurrentMonth + 1}-${i}`;
                    if (bookings[supervisorId] && bookings[supervisorId][dateKey]) {
                        dayElement.classList.add("has-bookings");
                    }

                    const currentDate = new Date();
                    const cellDate = new Date(psychologistCurrentYear, psychologistCurrentMonth, i);
                    if (
                        cellDate < currentDate &&
                        cellDate.getDate() !== currentDate.getDate()
                    ) {
                        dayElement.classList.add("disabled");
                    }

                    calendarDays.appendChild(dayElement);
                }

                renderPsychologistTimeSlots(supervisorId);
            }

            function renderPsychologistTimeSlots(supervisorId, selectedDay = null) {
                const timeSlotsContainer = document.getElementById("clientTimeSlotsContainer");
                timeSlotsContainer.innerHTML = "";

                if (!selectedDay) {
                    timeSlotsContainer.innerHTML = "<p></p>";
                    return;
                }

                const timeSlots = [
                    "09:00", "10:00", "11:00", "12:00", "13:00",
                    "14:00", "15:00", "16:00", "17:00", "18:00",
                ];

                timeSlots.forEach((slot, index) => {
                    const slotElement = document.createElement("div");
                    slotElement.className = "time-slot";
                    slotElement.textContent = slot;
                    slotElement.style.animationDelay = `${index * 0.1}s`;

                    const dateKey = `${psychologistCurrentYear}-${psychologistCurrentMonth + 1}-${selectedDay}`;
                    if (bookings[supervisorId] && bookings[supervisorId][dateKey] && bookings[supervisorId][dateKey][slot]) {
                        slotElement.classList.add("booked");
                        slotElement.setAttribute("data-client", bookings[supervisorId][dateKey][slot]);
                    } else {
                        slotElement.classList.add("available");
                    }

                    timeSlotsContainer.appendChild(slotElement);
                });
            }

            // Обработчики для модального календаря психолога
            document.getElementById("clientPrevMonth").addEventListener("click", () => {
                psychologistCurrentMonth--;
                if (psychologistCurrentMonth < 0) {
                    psychologistCurrentMonth = 11;
                    psychologistCurrentYear--;
                }
                const supervisorId = document.getElementById("clientBookingModal").getAttribute("data-specialist-id");
                renderPsychologistCalendar(supervisorId);
            });

            document.getElementById("clientNextMonth").addEventListener("click", () => {
                psychologistCurrentMonth++;
                if (psychologistCurrentMonth > 11) {
                    psychologistCurrentMonth = 0;
                    psychologistCurrentYear++;
                }
                const supervisorId = document.getElementById("clientBookingModal").getAttribute("data-specialist-id");
                renderPsychologistCalendar(supervisorId);
            });

            document.getElementById("clientCalendarDays").addEventListener("click", (e) => {
                if (
                    e.target.classList.contains("calendar-day") &&
                    !e.target.classList.contains("disabled")
                ) {
                    document
                        .querySelectorAll("#clientCalendarDays .calendar-day")
                        .forEach((day) => day.classList.remove("selected"));
                    e.target.classList.add("selected");
                    const supervisorId = document.getElementById("clientBookingModal").getAttribute("data-specialist-id");
                    renderPsychologistTimeSlots(supervisorId, e.target.textContent);
                }
            });

            document.getElementById("clientTimeSlotsContainer").addEventListener("click", (e) => {
                if (
                    e.target.classList.contains("time-slot") &&
                    !e.target.classList.contains("booked")
                ) {
                    document
                        .querySelectorAll("#clientTimeSlotsContainer .time-slot")
                        .forEach((slot) => slot.classList.remove("selected"));
                    e.target.classList.add("selected");
                }
            });

            // Подтверждение выбора времени для психолога
            document.getElementById("confirmClientTime").addEventListener("click", () => {
                const modal = document.getElementById("clientBookingModal");
                const supervisorId = modal.getAttribute("data-specialist-id");
                const appId = modal.getAttribute("data-app-id") || "";
                const supervisor = supervisorsData.find((s) => s.id == supervisorId);
                const selectedDayElement = document.querySelector("#clientCalendarDays .calendar-day.selected");
                if (!selectedDayElement) {
                    showNotification("Выберите день", "error");
                    return;
                }
                const selectedDay = selectedDayElement.textContent;
                const selectedTimeElement = document.querySelector("#clientTimeSlotsContainer .time-slot.selected");
                if (!selectedTimeElement) {
                    showNotification("Выберите время", "error");
                    return;
                }
                const selectedTime = selectedTimeElement.textContent;

                // Заполняем информацию о сессии
                const summaryElement = document.getElementById("bookingSummary");
                summaryElement.innerHTML = `
                <div class="booking-detail">
                    <strong>Супервизор:</strong> <span>${supervisor.name}</span>
                </div>
                <div class="booking-detail">
                    <strong>Дата:</strong> <span>${selectedDay} ${getMonthName(psychologistCurrentMonth)} ${psychologistCurrentYear}</span>
                </div>
                <div class="booking-detail">
                    <strong>Время:</strong> <span>${selectedTime}</span>
                </div>
                <div class="booking-detail">
                    <strong>Стоимость:</strong> <span>${supervisor.price} руб.</span>
                </div>
            `;

                // Сохраняем данные
                summaryElement.setAttribute("data-specialist-id", supervisorId);
                summaryElement.setAttribute("data-day", selectedDay);
                summaryElement.setAttribute("data-time", selectedTime);
                summaryElement.setAttribute("data-month", psychologistCurrentMonth + 1);
                summaryElement.setAttribute("data-year", psychologistCurrentYear);
                summaryElement.setAttribute("data-app-id", appId);

                closeModal("clientBookingModal");
                openModal("bookingModal");
            });
        }

        // Инициализация модала переноса для супервизора
        function initRescheduleModal() {
            let rescheduleCurrentMonth = new Date().getMonth();
            let rescheduleCurrentYear = new Date().getFullYear();

            function renderRescheduleCalendar(supervisorId) {
                const calendarDays = document.getElementById("rescheduleCalendarDays");
                calendarDays.innerHTML = "";

                const monthNames = [
                    "Январь",
                    "Февраль",
                    "Март",
                    "Апрель",
                    "Май",
                    "Июнь",
                    "Июль",
                    "Август",
                    "Сентябрь",
                    "Октябрь",
                    "Ноябрь",
                    "Декабрь",
                ];
                document.getElementById(
                    "rescheduleCalendarMonth"
                ).textContent = `${monthNames[rescheduleCurrentMonth]} ${rescheduleCurrentYear}`;

                // Заголовки дней недели
                const daysOfWeek = ["Пн", "Вт", "Ср", "Чт", "Пт", "Сб", "Вс"];
                daysOfWeek.forEach((day) => {
                    const dayElement = document.createElement("div");
                    dayElement.className = "calendar-day";
                    dayElement.textContent = day;
                    dayElement.style.fontWeight = "bold";
                    calendarDays.appendChild(dayElement);
                });

                const firstDay = new Date(rescheduleCurrentYear, rescheduleCurrentMonth, 1).getDay();
                const adjustedFirstDay = firstDay === 0 ? 6 : firstDay - 1;
                const daysInMonth = new Date(
                    rescheduleCurrentYear,
                    rescheduleCurrentMonth + 1,
                    0
                ).getDate();

                for (let i = 0; i < adjustedFirstDay; i++) {
                    const emptyDay = document.createElement("div");
                    emptyDay.className = "calendar-day disabled";
                    calendarDays.appendChild(emptyDay);
                }

                for (let i = 1; i <= daysInMonth; i++) {
                    const dayElement = document.createElement("div");
                    dayElement.className = "calendar-day";
                    dayElement.textContent = i;

                    const dateKey = `${rescheduleCurrentYear}-${rescheduleCurrentMonth + 1}-${i}`;
                    if (bookings[supervisorId] && bookings[supervisorId][dateKey]) {
                        dayElement.classList.add("has-bookings");
                    }

                    const currentDate = new Date();
                    const cellDate = new Date(rescheduleCurrentYear, rescheduleCurrentMonth, i);
                    if (
                        cellDate < currentDate &&
                        cellDate.getDate() !== currentDate.getDate()
                    ) {
                        dayElement.classList.add("disabled");
                    }

                    calendarDays.appendChild(dayElement);
                }

                renderRescheduleTimeSlots(supervisorId);
            }

            function renderRescheduleTimeSlots(supervisorId, selectedDay = null) {
                const timeSlotsContainer = document.getElementById("rescheduleTimeSlotsContainer");
                timeSlotsContainer.innerHTML = "";

                if (!selectedDay) {
                    timeSlotsContainer.innerHTML = "<p></p>";
                    return;
                }

                const timeSlots = [
                    "09:00", "10:00", "11:00", "12:00", "13:00",
                    "14:00", "15:00", "16:00", "17:00", "18:00",
                ];

                timeSlots.forEach((slot, index) => {
                    const slotElement = document.createElement("div");
                    slotElement.className = "time-slot";
                    slotElement.textContent = slot;
                    slotElement.style.animationDelay = `${index * 0.1}s`;

                    const dateKey = `${rescheduleCurrentYear}-${rescheduleCurrentMonth + 1}-${selectedDay}`;
                    if (bookings[supervisorId] && bookings[supervisorId][dateKey] && bookings[supervisorId][dateKey][slot]) {
                        slotElement.classList.add("booked");
                        slotElement.setAttribute("data-client", bookings[supervisorId][dateKey][slot]);
                    } else {
                        slotElement.classList.add("available");
                    }

                    timeSlotsContainer.appendChild(slotElement);
                });
            }

            // Обработчики для модального календаря переноса
            document.getElementById("reschedulePrevMonth").addEventListener("click", () => {
                rescheduleCurrentMonth--;
                if (rescheduleCurrentMonth < 0) {
                    rescheduleCurrentMonth = 11;
                    rescheduleCurrentYear--;
                }
                const supervisorId = document.getElementById("rescheduleModal").getAttribute("data-specialist-id");
                renderRescheduleCalendar(supervisorId);
            });

            document.getElementById("rescheduleNextMonth").addEventListener("click", () => {
                rescheduleCurrentMonth++;
                if (rescheduleCurrentMonth > 11) {
                    rescheduleCurrentMonth = 0;
                    rescheduleCurrentYear++;
                }
                const supervisorId = document.getElementById("rescheduleModal").getAttribute("data-specialist-id");
                renderRescheduleCalendar(supervisorId);
            });

            document.getElementById("rescheduleCalendarDays").addEventListener("click", (e) => {
                if (
                    e.target.classList.contains("calendar-day") &&
                    !e.target.classList.contains("disabled")
                ) {
                    document
                        .querySelectorAll("#rescheduleCalendarDays .calendar-day")
                        .forEach((day) => day.classList.remove("selected"));
                    e.target.classList.add("selected");
                    const supervisorId = document.getElementById("rescheduleModal").getAttribute("data-specialist-id");
                    renderRescheduleTimeSlots(supervisorId, e.target.textContent);
                }
            });

            document.getElementById("rescheduleTimeSlotsContainer").addEventListener("click", (e) => {
                if (
                    e.target.classList.contains("time-slot") &&
                    !e.target.classList.contains("booked")
                ) {
                    document
                        .querySelectorAll("#rescheduleTimeSlotsContainer .time-slot")
                        .forEach((slot) => slot.classList.remove("selected"));
                    e.target.classList.add("selected");
                }
            });

            // Подтверждение переноса
            document.getElementById("confirmReschedule").addEventListener("click", () => {
                const modal = document.getElementById("rescheduleModal");
                const appId = modal.getAttribute("data-app-id");
                const supervisorId = modal.getAttribute("data-specialist-id");
                const selectedDayElement = document.querySelector("#rescheduleCalendarDays .calendar-day.selected");
                if (!selectedDayElement) {
                    showNotification("Выберите день", "error");
                    return;
                }
                const selectedDay = selectedDayElement.textContent;
                const selectedTimeElement = document.querySelector("#rescheduleTimeSlotsContainer .time-slot.selected");
                if (!selectedTimeElement) {
                    showNotification("Выберите время", "error");
                    return;
                }
                const selectedTime = selectedTimeElement.textContent;

                const appIndex = appointmentsData.findIndex(a => a.id == appId);
                if (appIndex !== -1) {
                    appointmentsData[appIndex].dateDay = parseInt(selectedDay);
                    appointmentsData[appIndex].dateMonth = rescheduleCurrentMonth + 1;
                    appointmentsData[appIndex].dateYear = rescheduleCurrentYear;
                    appointmentsData[appIndex].time = selectedTime;
                    appointmentsData[appIndex].status = "confirmed"; // После переноса сразу подтверждаем

                    Storage.set(STORAGE_KEYS.APPOINTMENTS, appointmentsData);
                    updateBookingsFromAppointments();

                    closeModal("rescheduleModal");
                    showNotification("Сессия перенесена", "success");

                    // Обновляем views
                    renderAllAppointments();
                    renderCalendar();
                    loadSupervisorPsychologists();
                    renderPsychologists();
                }
            });
        }

        // Открытие модального окна переноса
        function openRescheduleModal(appId) {
            const appointment = appointmentsData.find(a => a.id == appId);
            if (appointment) {
                document.getElementById("rescheduleModal").setAttribute("data-app-id", appId);
                document.getElementById("rescheduleModal").setAttribute("data-specialist-id", appointment.specialistId);
                openModal("rescheduleModal");
                renderRescheduleCalendar(appointment.specialistId);
            }
        }
    </script>
</body>

</html>
